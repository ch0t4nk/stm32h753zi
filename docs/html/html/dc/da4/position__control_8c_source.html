<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32H753ZI Motor Control System: src/controllers/position_control.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">STM32H753ZI Motor Control System
   &#160;<span id="projectnumber">v1.0.0</span>
   </div>
   <div id="projectbrief">Advanced stepper motor control with X-CUBE-SPN2 and safety systems</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_bbd6674d859f4cefaacb708974cac240.html">controllers</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">position_control.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../dc/da4/position__control_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/dba/position__control_8h.html">position_control.h</a>&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d58/motor__config_8h.html">config/motor_config.h</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d5c/safety__config_8h.html">config/safety_config.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d2b/as5600__driver_8h.html">drivers/as5600/as5600_driver.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/dee/hal__abstraction_8h.html">hal_abstraction/hal_abstraction.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d07/motion__profile_8h.html">motion_profile.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d2b/fault__monitor_8h.html">safety/fault_monitor.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/* ==========================================================================</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/* Forward Declarations for Static Functions                                 */</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">/* ==========================================================================</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">static</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#a763c7a687700d7f95c9cf8a3c96f5583">read_encoder_position</a>(uint8_t motor_id,</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                                           int32_t *position);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/da4/position__control_8c.html#ac71d46770c357b533957c709fa081fb9">apply_position_filter</a>(<a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/da4/position__control_8c.html#a98422e982bfa9adad8d106cb2a73af1c">calculate_velocity</a>(<a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl, uint32_t dt_ms);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../dc/da4/position__control_8c.html#a095abd40d44cddc26583de9affb78e40">calculate_pid_output</a>(<a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl, uint32_t dt_ms);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../dc/da4/position__control_8c.html#ace405738f9ea0b1023b6fcd8a636d093">calculate_feedforward_output</a>(<a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl,</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                                          uint32_t target_velocity,</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                                          uint32_t dt_ms);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../dc/da4/position__control_8c.html#a54b590c5c09205e845046da05e5953f2">apply_output_limits</a>(<a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl, <span class="keywordtype">float</span> output);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">static</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#a117e7d808d57f0bc0e3bf92c569fcae9">send_motor_command</a>(uint8_t motor_id, <span class="keywordtype">float</span> output);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/da4/position__control_8c.html#aadb57d32bcfb4b041904b7b213b83191">update_control_history</a>(<a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">static</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<a class="code" href="../../dc/da4/position__control_8c.html#a4f9b03e439d6601bdd135177c53d0d39">perform_limit_switch_homing</a>(uint8_t motor_id, <a class="code" href="../../da/d77/structHomingConfig__t.html">HomingConfig_t</a> *homing_config);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keyword">static</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<a class="code" href="../../dc/da4/position__control_8c.html#a49190ef760e7b0cd28f56d3908db5e10">perform_encoder_index_homing</a>(uint8_t motor_id, <a class="code" href="../../da/d77/structHomingConfig__t.html">HomingConfig_t</a> *homing_config);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="keyword">static</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<a class="code" href="../../dc/da4/position__control_8c.html#a09879579977fed59d371b825ab933eb5">perform_current_position_homing</a>(uint8_t motor_id,</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                                <a class="code" href="../../da/d77/structHomingConfig__t.html">HomingConfig_t</a> *homing_config);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="../../dc/da4/position__control_8c.html#a9bc07c780a72962a6f64022bd1f8c316">check_limit_switch</a>(uint8_t motor_id);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">// Position control state for each motor</span></div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a705389210072ceb00b3c38cb4a55e0bb">   49</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#a705389210072ceb00b3c38cb4a55e0bb">position_controllers</a>[<a class="code" href="../../de/d58/motor__config_8h.html#a40dfd7fdfce455ce507bf3fed368c2ed">MAX_MOTORS</a>];</div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a2b1683f4bab80c7b1e55466c8668548b">   50</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="../../dc/da4/position__control_8c.html#a2b1683f4bab80c7b1e55466c8668548b">controller_initialized</a>[<a class="code" href="../../de/d58/motor__config_8h.html#a40dfd7fdfce455ce507bf3fed368c2ed">MAX_MOTORS</a>] = {<span class="keyword">false</span>};</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a6d45acd4b190d726e2f188a1f211d11c">   56</a></span>&#160;<a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#a6d45acd4b190d726e2f188a1f211d11c">position_control_init</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// Clear all controllers</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    memset(<a class="code" href="../../dc/da4/position__control_8c.html#a705389210072ceb00b3c38cb4a55e0bb">position_controllers</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../dc/da4/position__control_8c.html#a705389210072ceb00b3c38cb4a55e0bb">position_controllers</a>));</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    memset(<a class="code" href="../../dc/da4/position__control_8c.html#a2b1683f4bab80c7b1e55466c8668548b">controller_initialized</a>, <span class="keyword">false</span>, <span class="keyword">sizeof</span>(<a class="code" href="../../dc/da4/position__control_8c.html#a2b1683f4bab80c7b1e55466c8668548b">controller_initialized</a>));</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// Initialize each motor&#39;s position controller</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">for</span> (uint8_t motor_id = 0; motor_id &lt; <a class="code" href="../../de/d58/motor__config_8h.html#a40dfd7fdfce455ce507bf3fed368c2ed">MAX_MOTORS</a>; motor_id++) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> result = <a class="code" href="../../dc/da4/position__control_8c.html#ab512f90f1df8ee9d95f6a00b3241c6c6">position_control_init_motor</a>(motor_id);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="keywordflow">if</span> (result != <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>) {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    }</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;}</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#ab512f90f1df8ee9d95f6a00b3241c6c6">   77</a></span>&#160;<a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#ab512f90f1df8ee9d95f6a00b3241c6c6">position_control_init_motor</a>(uint8_t motor_id) {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span> (motor_id &gt;= <a class="code" href="../../de/d58/motor__config_8h.html#a40dfd7fdfce455ce507bf3fed368c2ed">MAX_MOTORS</a>) {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756a6ac534e278ae408341dfc83c9d3a063f">ERROR_MOTOR_INVALID_ID</a>;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    }</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl = &amp;<a class="code" href="../../dc/da4/position__control_8c.html#a705389210072ceb00b3c38cb4a55e0bb">position_controllers</a>[motor_id];</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// Initialize PID parameters from SSOT configuration</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a3ad223e0c4b675e54858a88f90a06f1f">kp</a> = <a class="code" href="../../d0/dba/position__control_8h.html#a72d6bf77514bb1a953463d2e6922787b">PID_KP_DEFAULT</a>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a60697e647e9ae3ec45ac3cece71578ee">ki</a> = <a class="code" href="../../d0/dba/position__control_8h.html#a924fd30878e3eeb2332b3e6b2a9b15f6">PID_KI_DEFAULT</a>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#aac2a7700498a0c72d67053eeabfaa39b">kd</a> = <a class="code" href="../../d0/dba/position__control_8h.html#a99d2b31d805a81b682ebf2f7d891082a">PID_KD_DEFAULT</a>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a560e138364e3a041a8f28f1452a1a8b6">integral_limit</a> = <a class="code" href="../../d0/dba/position__control_8h.html#a4ec081867aed740755f68feaa50ecc47">PID_INTEGRAL_LIMIT</a>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a6c7efae90d78be4106a9cd604b6f291c">output_limit</a> = <a class="code" href="../../d0/dba/position__control_8h.html#a699c67c6959d9c0134ee91ed365fca4c">PID_OUTPUT_LIMIT</a>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// Initialize feedforward parameters</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a6b4144b9819542bcd46d917883060d8a">feedforward</a>.<a class="code" href="../../d2/de8/structFeedforwardController__t.html#ad18eb49002c9378afbd0427a257f68ec">velocity_gain</a> = <a class="code" href="../../d0/dba/position__control_8h.html#a2b8b31e7da7d9fd2a4a6bd30bec2b17c">FEEDFORWARD_VEL_GAIN</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a6b4144b9819542bcd46d917883060d8a">feedforward</a>.<a class="code" href="../../d2/de8/structFeedforwardController__t.html#a1da238881ba0ed98f6977034391fbe5a">acceleration_gain</a> = <a class="code" href="../../d0/dba/position__control_8h.html#a6a06a31b7d815ec8a2fd80e6fb7db9f0">FEEDFORWARD_ACCEL_GAIN</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a6b4144b9819542bcd46d917883060d8a">feedforward</a>.<a class="code" href="../../d2/de8/structFeedforwardController__t.html#ab94fa9f23d37c3c6541733120ec23048">friction_compensation</a> = <a class="code" href="../../d0/dba/position__control_8h.html#a9da4040f542f11c875f261e5ff94da2f">FEEDFORWARD_FRICTION_COMP</a>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// Initialize control limits</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a524e4e3fdd4ec0e01e4b2936b31c302b">limits</a>.<a class="code" href="../../de/dac/structControlLimits__t.html#a2b8f697ef4a4741dbbf45caccc23d1c8">max_position_error</a> = <a class="code" href="../../d3/d91/hardware__config_8h.html#a2f2edf5b882e1d4a24e568957fd86246">MAX_POSITION_ERROR_STEPS</a>;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a524e4e3fdd4ec0e01e4b2936b31c302b">limits</a>.<a class="code" href="../../de/dac/structControlLimits__t.html#a00e66f878eb1e60d5457b996a5403ce4">max_velocity</a> = <a class="code" href="../../de/d58/motor__config_8h.html#a28d8a416ec448cfade8aca6ec9a58444">MOTOR_MAX_SPEED</a>;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a524e4e3fdd4ec0e01e4b2936b31c302b">limits</a>.<a class="code" href="../../de/dac/structControlLimits__t.html#a985b4f115e64801107cf1a74a9120bed">max_acceleration</a> = <a class="code" href="../../de/d58/motor__config_8h.html#a0a8a9d31c5e91084e3821e23d35af5de">MOTOR_MAX_ACCELERATION</a>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// Initialize state</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#ac1b662cfe97ce5095085584029e58b8d">current_position</a> = 0;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aaf1d32c71d7d84d8697094a370859427">target_position</a> = 0;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a43bd62301b102cdd644f81af386a7326">position_error</a> = 0;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aa36784080e2f5a2bd79aaa5679e03956">velocity</a> = 0;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aa605c090706a7f0b6707c36bf6de7628">enabled</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a212e3f5edbb70e5890ca8b0f9b160494">homed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// Initialize filter</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#aba109f7064cc6908c96f541d015a6092">filter</a>.<a class="code" href="../../d5/d1f/structPositionFilter__t.html#a1701e6979cd4bb15856f03bf0173dd35">position_filter_alpha</a> = <a class="code" href="../../d0/dba/position__control_8h.html#aca1be497a5c032870050b7553aca17a3">POSITION_FILTER_ALPHA</a>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#aba109f7064cc6908c96f541d015a6092">filter</a>.<a class="code" href="../../d5/d1f/structPositionFilter__t.html#a86d14add504a2faf66d45d6808f38e6d">velocity_filter_alpha</a> = <a class="code" href="../../d0/dba/position__control_8h.html#a1a5da372bddcb3ae03c10bd52956f620">VELOCITY_FILTER_ALPHA</a>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">// Clear history</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    memset(&amp;ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a7ee3645e7fbff18ef6fda7446dab21bd">history</a>, 0, <span class="keyword">sizeof</span>(ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a7ee3645e7fbff18ef6fda7446dab21bd">history</a>));</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="../../dc/da4/position__control_8c.html#a2b1683f4bab80c7b1e55466c8668548b">controller_initialized</a>[motor_id] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;}</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#af170ceb5af2fca6d2388a020b7e3efab">  127</a></span>&#160;<a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#af170ceb5af2fca6d2388a020b7e3efab">position_control_update</a>(uint8_t motor_id, uint32_t dt_ms) {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">if</span> (motor_id &gt;= <a class="code" href="../../de/d58/motor__config_8h.html#a40dfd7fdfce455ce507bf3fed368c2ed">MAX_MOTORS</a> || !<a class="code" href="../../dc/da4/position__control_8c.html#a2b1683f4bab80c7b1e55466c8668548b">controller_initialized</a>[motor_id]) {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756a6ac534e278ae408341dfc83c9d3a063f">ERROR_MOTOR_INVALID_ID</a>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl = &amp;<a class="code" href="../../dc/da4/position__control_8c.html#a705389210072ceb00b3c38cb4a55e0bb">position_controllers</a>[motor_id];</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">if</span> (!ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aa605c090706a7f0b6707c36bf6de7628">enabled</a>) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>; <span class="comment">// Controller not enabled</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// Read current position from encoder</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> result =</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <a class="code" href="../../dc/da4/position__control_8c.html#a763c7a687700d7f95c9cf8a3c96f5583">read_encoder_position</a>(motor_id, &amp;ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#ac1b662cfe97ce5095085584029e58b8d">current_position</a>);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>) {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="comment">// Handle encoder fault</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <a class="code" href="../../df/d2b/fault__monitor_8h.html#ab9778577bce2d2a4efe52d79b03c0c5d">fault_monitor_report_fault</a>(motor_id, <a class="code" href="../../df/d2b/fault__monitor_8h.html#a2db4dddbfc701ca63d8e6449e5453d9c">FAULT_ENCODER_COMMUNICATION</a>);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">// Apply position filtering</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="../../dc/da4/position__control_8c.html#ac71d46770c357b533957c709fa081fb9">apply_position_filter</a>(ctrl);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// Calculate position error</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a43bd62301b102cdd644f81af386a7326">position_error</a> =</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aaf1d32c71d7d84d8697094a370859427">target_position</a> - ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#ac1b662cfe97ce5095085584029e58b8d">current_position</a>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// Check for excessive position error</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (abs(ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a43bd62301b102cdd644f81af386a7326">position_error</a>) &gt; ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a524e4e3fdd4ec0e01e4b2936b31c302b">limits</a>.<a class="code" href="../../de/dac/structControlLimits__t.html#a2b8f697ef4a4741dbbf45caccc23d1c8">max_position_error</a>) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <a class="code" href="../../df/d2b/fault__monitor_8h.html#ab9778577bce2d2a4efe52d79b03c0c5d">fault_monitor_report_fault</a>(motor_id, <a class="code" href="../../df/d2b/fault__monitor_8h.html#a8b6c4b8342f0cfcc176682aa2c0e6a0c">FAULT_POSITION_ERROR_EXCESSIVE</a>);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d0/dba/position__control_8h.html#a3434b6ac3248cad40560528dcbc51b1a">ERROR_POSITION_ERROR_EXCESSIVE</a>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// Calculate velocity</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <a class="code" href="../../dc/da4/position__control_8c.html#a98422e982bfa9adad8d106cb2a73af1c">calculate_velocity</a>(ctrl, dt_ms);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// Get motion profile targets if active</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    int32_t profile_target_pos = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aaf1d32c71d7d84d8697094a370859427">target_position</a>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    uint32_t profile_target_vel = 0;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/de7/motion__profile_8c.html#a80b846f20fe162e676d1cc4e20574199">motion_profile_is_active</a>(motor_id)) {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <a class="code" href="../../d1/d63/structMotionProfileStatus__t.html">MotionProfileStatus_t</a> profile_status;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <a class="code" href="../../d2/de7/motion__profile_8c.html#ad59259d434366c76b8611397fd790d42">motion_profile_get_status</a>(motor_id, &amp;profile_status);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        profile_target_pos = profile_status.<a class="code" href="../../d1/d63/structMotionProfileStatus__t.html#af50735ad371f2969e4a69fb52c6f4fe7">current_target_position</a>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        profile_target_vel = profile_status.<a class="code" href="../../d1/d63/structMotionProfileStatus__t.html#a4ec3b77abd3f19eb15cc8658799aa297">current_target_velocity</a>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="comment">// Update target position from profile</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aaf1d32c71d7d84d8697094a370859427">target_position</a> = profile_target_pos;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a43bd62301b102cdd644f81af386a7326">position_error</a> =</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aaf1d32c71d7d84d8697094a370859427">target_position</a> - ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#ac1b662cfe97ce5095085584029e58b8d">current_position</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">// Calculate PID output</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordtype">float</span> pid_output = <a class="code" href="../../dc/da4/position__control_8c.html#a095abd40d44cddc26583de9affb78e40">calculate_pid_output</a>(ctrl, dt_ms);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// Calculate feedforward output</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordtype">float</span> feedforward_output =</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <a class="code" href="../../dc/da4/position__control_8c.html#ace405738f9ea0b1023b6fcd8a636d093">calculate_feedforward_output</a>(ctrl, profile_target_vel, dt_ms);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">// Combine PID and feedforward</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">float</span> total_output = pid_output + feedforward_output;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">// Apply output limits</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    total_output = <a class="code" href="../../dc/da4/position__control_8c.html#a54b590c5c09205e845046da05e5953f2">apply_output_limits</a>(ctrl, total_output);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">// Convert to motor command</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    result = <a class="code" href="../../dc/da4/position__control_8c.html#a117e7d808d57f0bc0e3bf92c569fcae9">send_motor_command</a>(motor_id, total_output);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// Update history for next iteration</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="../../dc/da4/position__control_8c.html#aadb57d32bcfb4b041904b7b213b83191">update_control_history</a>(ctrl);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;}</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a20e9bdf8668ebd21b208c00c9550ca04">  210</a></span>&#160;<a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#a20e9bdf8668ebd21b208c00c9550ca04">position_control_set_target</a>(uint8_t motor_id,</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                                          int32_t target_position) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span> (motor_id &gt;= <a class="code" href="../../de/d58/motor__config_8h.html#a40dfd7fdfce455ce507bf3fed368c2ed">MAX_MOTORS</a> || !<a class="code" href="../../dc/da4/position__control_8c.html#a2b1683f4bab80c7b1e55466c8668548b">controller_initialized</a>[motor_id]) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756a6ac534e278ae408341dfc83c9d3a063f">ERROR_MOTOR_INVALID_ID</a>;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl = &amp;<a class="code" href="../../dc/da4/position__control_8c.html#a705389210072ceb00b3c38cb4a55e0bb">position_controllers</a>[motor_id];</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// Validate target position</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">if</span> (abs(target_position) &gt; <a class="code" href="../../d0/dba/position__control_8h.html#a87746b211d4bd81c20bc14be3c39a45a">MAX_POSITION_STEPS</a>) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d0/dba/position__control_8h.html#adf88ac31c9920b19ec09f4a74de16514">ERROR_POSITION_OUT_OF_RANGE</a>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aaf1d32c71d7d84d8697094a370859427">target_position</a> = target_position;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#ab3b0d9cb2203bdfd86d4e0db5737f954">  234</a></span>&#160;<a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#ab3b0d9cb2203bdfd86d4e0db5737f954">position_control_enable</a>(uint8_t motor_id, <span class="keywordtype">bool</span> enable) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">if</span> (motor_id &gt;= <a class="code" href="../../de/d58/motor__config_8h.html#a40dfd7fdfce455ce507bf3fed368c2ed">MAX_MOTORS</a> || !<a class="code" href="../../dc/da4/position__control_8c.html#a2b1683f4bab80c7b1e55466c8668548b">controller_initialized</a>[motor_id]) {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756a6ac534e278ae408341dfc83c9d3a063f">ERROR_MOTOR_INVALID_ID</a>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl = &amp;<a class="code" href="../../dc/da4/position__control_8c.html#a705389210072ceb00b3c38cb4a55e0bb">position_controllers</a>[motor_id];</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">if</span> (enable &amp;&amp; !ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aa605c090706a7f0b6707c36bf6de7628">enabled</a>) {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="comment">// Enabling controller - reset integral term</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a6175c7a4f8511cdfcf545823da64acf9">integral</a> = 0;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="comment">// Read current position as starting point</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <a class="code" href="../../dc/da4/position__control_8c.html#a763c7a687700d7f95c9cf8a3c96f5583">read_encoder_position</a>(motor_id, &amp;ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#ac1b662cfe97ce5095085584029e58b8d">current_position</a>);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aaf1d32c71d7d84d8697094a370859427">target_position</a> = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#ac1b662cfe97ce5095085584029e58b8d">current_position</a>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a43bd62301b102cdd644f81af386a7326">position_error</a> = 0;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aa605c090706a7f0b6707c36bf6de7628">enabled</a> = enable;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;}</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a3b3cbeeaa7fdb973fb71dffedd78c668">  262</a></span>&#160;<a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#a3b3cbeeaa7fdb973fb71dffedd78c668">position_control_home</a>(uint8_t motor_id,</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                                    <a class="code" href="../../da/d77/structHomingConfig__t.html">HomingConfig_t</a> *homing_config) {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">if</span> (motor_id &gt;= <a class="code" href="../../de/d58/motor__config_8h.html#a40dfd7fdfce455ce507bf3fed368c2ed">MAX_MOTORS</a> || !<a class="code" href="../../dc/da4/position__control_8c.html#a2b1683f4bab80c7b1e55466c8668548b">controller_initialized</a>[motor_id] ||</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        homing_config == <a class="code" href="../../d1/db4/stm32h7xx__hal__def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756aeae4b12e06d727d085f75f79a820f2e8">ERROR_INVALID_PARAMETER</a>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl = &amp;<a class="code" href="../../dc/da4/position__control_8c.html#a705389210072ceb00b3c38cb4a55e0bb">position_controllers</a>[motor_id];</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// Disable position control during homing</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <a class="code" href="../../dc/da4/position__control_8c.html#ab3b0d9cb2203bdfd86d4e0db5737f954">position_control_enable</a>(motor_id, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> result = <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">switch</span> (homing_config-&gt;<a class="code" href="../../da/d77/structHomingConfig__t.html#a0a79006da4a85264a00f365e858775be">method</a>) {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d0/dba/position__control_8h.html#a0260fb6f0e1113415bd50bf21ff3dc40a43006555caecb264f48dacf4dfd46475">HOMING_METHOD_LIMIT_SWITCH</a>:</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        result = <a class="code" href="../../dc/da4/position__control_8c.html#a4f9b03e439d6601bdd135177c53d0d39">perform_limit_switch_homing</a>(motor_id, homing_config);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d0/dba/position__control_8h.html#a0260fb6f0e1113415bd50bf21ff3dc40a8e71ee9cf368c3a9c91fb07232d77481">HOMING_METHOD_ENCODER_INDEX</a>:</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        result = <a class="code" href="../../dc/da4/position__control_8c.html#a49190ef760e7b0cd28f56d3908db5e10">perform_encoder_index_homing</a>(motor_id, homing_config);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="../../d0/dba/position__control_8h.html#a0260fb6f0e1113415bd50bf21ff3dc40a957d4d49774fce43e66a28fbcec36bc9">HOMING_METHOD_CURRENT_POSITION</a>:</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        result = <a class="code" href="../../dc/da4/position__control_8c.html#a09879579977fed59d371b825ab933eb5">perform_current_position_homing</a>(motor_id, homing_config);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        result = <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756aeae4b12e06d727d085f75f79a820f2e8">ERROR_INVALID_PARAMETER</a>;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">if</span> (result == <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>) {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a212e3f5edbb70e5890ca8b0f9b160494">homed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#ac1b662cfe97ce5095085584029e58b8d">current_position</a> = homing_config-&gt;<a class="code" href="../../da/d77/structHomingConfig__t.html#a41987e557c49e12e42d8175b8529233d">home_offset</a>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aaf1d32c71d7d84d8697094a370859427">target_position</a> = homing_config-&gt;<a class="code" href="../../da/d77/structHomingConfig__t.html#a41987e557c49e12e42d8175b8529233d">home_offset</a>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="comment">// Re-enable position control</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <a class="code" href="../../dc/da4/position__control_8c.html#ab3b0d9cb2203bdfd86d4e0db5737f954">position_control_enable</a>(motor_id, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;}</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a420cf63344eb43cb92af724ee1b0d16e">  312</a></span>&#160;<a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#a420cf63344eb43cb92af724ee1b0d16e">position_control_get_status</a>(uint8_t motor_id,</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                                          <a class="code" href="../../df/d9d/structPositionControlStatus__t.html">PositionControlStatus_t</a> *status) {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordflow">if</span> (motor_id &gt;= <a class="code" href="../../de/d58/motor__config_8h.html#a40dfd7fdfce455ce507bf3fed368c2ed">MAX_MOTORS</a> || !<a class="code" href="../../dc/da4/position__control_8c.html#a2b1683f4bab80c7b1e55466c8668548b">controller_initialized</a>[motor_id] ||</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        status == <a class="code" href="../../d1/db4/stm32h7xx__hal__def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756aeae4b12e06d727d085f75f79a820f2e8">ERROR_INVALID_PARAMETER</a>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl = &amp;<a class="code" href="../../dc/da4/position__control_8c.html#a705389210072ceb00b3c38cb4a55e0bb">position_controllers</a>[motor_id];</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    status-&gt;<a class="code" href="../../df/d9d/structPositionControlStatus__t.html#afe1ab1da481a8e9ad0e08924b8d36484">enabled</a> = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aa605c090706a7f0b6707c36bf6de7628">enabled</a>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    status-&gt;<a class="code" href="../../df/d9d/structPositionControlStatus__t.html#a8179e7d88d7c29fee336b8a2bc3d12df">homed</a> = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a212e3f5edbb70e5890ca8b0f9b160494">homed</a>;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    status-&gt;<a class="code" href="../../df/d9d/structPositionControlStatus__t.html#a6c9e70952f6e39b019910d177a48d9fb">current_position</a> = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#ac1b662cfe97ce5095085584029e58b8d">current_position</a>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    status-&gt;<a class="code" href="../../df/d9d/structPositionControlStatus__t.html#a67a2c104c93c07b71d5cfc8fc281126d">target_position</a> = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aaf1d32c71d7d84d8697094a370859427">target_position</a>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    status-&gt;<a class="code" href="../../df/d9d/structPositionControlStatus__t.html#ae1628b7231e769fb292626988a61f2c3">position_error</a> = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a43bd62301b102cdd644f81af386a7326">position_error</a>;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    status-&gt;<a class="code" href="../../df/d9d/structPositionControlStatus__t.html#a057bdfff37ec5993296e39b46e22db64">velocity</a> = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aa36784080e2f5a2bd79aaa5679e03956">velocity</a>;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    status-&gt;<a class="code" href="../../df/d9d/structPositionControlStatus__t.html#a307170da250523007677eb8865c30e0e">pid_output</a> = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a7ee3645e7fbff18ef6fda7446dab21bd">history</a>.<a class="code" href="../../d5/d2c/structControlHistory__t.html#a185608b989603067ccc8f97f88a3965f">last_pid_output</a>;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    status-&gt;<a class="code" href="../../df/d9d/structPositionControlStatus__t.html#ad2f3157c07e9d2ef583ca503b22fa9f9">feedforward_output</a> = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a7ee3645e7fbff18ef6fda7446dab21bd">history</a>.<a class="code" href="../../d5/d2c/structControlHistory__t.html#a38c5f33e548b17107bdeb1381af88fe9">last_feedforward_output</a>;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">// Calculate if position is settled</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    status-&gt;<a class="code" href="../../df/d9d/structPositionControlStatus__t.html#a61ac4c0eda402996490d78f4340357fc">position_settled</a> =</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        (abs(ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a43bd62301b102cdd644f81af386a7326">position_error</a>) &lt;= <a class="code" href="../../d0/dba/position__control_8h.html#a61476935076615227a674d21e59f057a">POSITION_SETTLED_THRESHOLD</a>) &amp;&amp;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        (fabsf(ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aa36784080e2f5a2bd79aaa5679e03956">velocity</a>) &lt;= <a class="code" href="../../d0/dba/position__control_8h.html#a4095ca74f14971350013a72adfecaabe">VELOCITY_SETTLED_THRESHOLD</a>);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;}</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a763c7a687700d7f95c9cf8a3c96f5583">  341</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#a763c7a687700d7f95c9cf8a3c96f5583">read_encoder_position</a>(uint8_t motor_id,</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                                           int32_t *position) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    uint16_t raw_angle;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> result = <a class="code" href="../../d0/dba/position__control_8h.html#ab512a9478ef4f61dcfe636c2616b8df9">as5600_read_angle</a>(motor_id, &amp;raw_angle);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">// Convert angle to steps (4096 counts per revolution)</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">// Assuming motor has MOTOR_STEPS_PER_REV steps per revolution</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    *position = (int32_t)((uint32_t)raw_angle * <a class="code" href="../../de/d58/motor__config_8h.html#abf55bbaef296f1119be253019fc208d9">MOTOR_STEPS_PER_REV</a> / 4096);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;}</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00360"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#ac71d46770c357b533957c709fa081fb9">  360</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/da4/position__control_8c.html#ac71d46770c357b533957c709fa081fb9">apply_position_filter</a>(<a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl) {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// Simple first-order low-pass filter</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a819bd521fcdaf105f05e83bf016c289a">filtered_position</a> =</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        (ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#aba109f7064cc6908c96f541d015a6092">filter</a>.<a class="code" href="../../d5/d1f/structPositionFilter__t.html#a1701e6979cd4bb15856f03bf0173dd35">position_filter_alpha</a> * ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#ac1b662cfe97ce5095085584029e58b8d">current_position</a>) +</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        ((1.0f - ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#aba109f7064cc6908c96f541d015a6092">filter</a>.<a class="code" href="../../d5/d1f/structPositionFilter__t.html#a1701e6979cd4bb15856f03bf0173dd35">position_filter_alpha</a>) *</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;         ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a819bd521fcdaf105f05e83bf016c289a">filtered_position</a>);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;}</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a98422e982bfa9adad8d106cb2a73af1c">  371</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/da4/position__control_8c.html#a98422e982bfa9adad8d106cb2a73af1c">calculate_velocity</a>(<a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl, uint32_t dt_ms) {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">if</span> (dt_ms == 0)</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160; </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordtype">float</span> dt_sec = (float)dt_ms / 1000.0f;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    int32_t position_diff =</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#ac1b662cfe97ce5095085584029e58b8d">current_position</a> - ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a7ee3645e7fbff18ef6fda7446dab21bd">history</a>.<a class="code" href="../../d5/d2c/structControlHistory__t.html#a582b1984d7fc51f40299aacafb4c21f6">last_position</a>;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">// Calculate raw velocity</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordtype">float</span> raw_velocity = (float)position_diff / dt_sec;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="comment">// Apply velocity filtering</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aa36784080e2f5a2bd79aaa5679e03956">velocity</a> =</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        (ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#aba109f7064cc6908c96f541d015a6092">filter</a>.<a class="code" href="../../d5/d1f/structPositionFilter__t.html#a86d14add504a2faf66d45d6808f38e6d">velocity_filter_alpha</a> * raw_velocity) +</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        ((1.0f - ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#aba109f7064cc6908c96f541d015a6092">filter</a>.<a class="code" href="../../d5/d1f/structPositionFilter__t.html#a86d14add504a2faf66d45d6808f38e6d">velocity_filter_alpha</a>) * ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#aa36784080e2f5a2bd79aaa5679e03956">velocity</a>);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;}</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a095abd40d44cddc26583de9affb78e40">  391</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../dc/da4/position__control_8c.html#a095abd40d44cddc26583de9affb78e40">calculate_pid_output</a>(<a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl, uint32_t dt_ms) {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">if</span> (dt_ms == 0)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">return</span> 0.0f;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordtype">float</span> dt_sec = (float)dt_ms / 1000.0f;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordtype">float</span> error = (float)ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a43bd62301b102cdd644f81af386a7326">position_error</a>;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="comment">// Proportional term</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordtype">float</span> p_term = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a3ad223e0c4b675e54858a88f90a06f1f">kp</a> * error;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">// Integral term</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a6175c7a4f8511cdfcf545823da64acf9">integral</a> += error * dt_sec;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="comment">// Apply integral windup protection</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    if (ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a6175c7a4f8511cdfcf545823da64acf9">integral</a> &gt; ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a560e138364e3a041a8f28f1452a1a8b6">integral_limit</a>) {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a6175c7a4f8511cdfcf545823da64acf9">integral</a> = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a560e138364e3a041a8f28f1452a1a8b6">integral_limit</a>;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a6175c7a4f8511cdfcf545823da64acf9">integral</a> &lt; -ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a560e138364e3a041a8f28f1452a1a8b6">integral_limit</a>) {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a6175c7a4f8511cdfcf545823da64acf9">integral</a> = -ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a560e138364e3a041a8f28f1452a1a8b6">integral_limit</a>;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordtype">float</span> i_term = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a60697e647e9ae3ec45ac3cece71578ee">ki</a> * ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a6175c7a4f8511cdfcf545823da64acf9">integral</a>;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="comment">// Derivative term (using filtered derivative)</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordtype">float</span> error_diff = error - ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a7ee3645e7fbff18ef6fda7446dab21bd">history</a>.<a class="code" href="../../d5/d2c/structControlHistory__t.html#a16c4937c2ffd9598fd75da9150dd5409">last_error</a>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordtype">float</span> d_term = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#aac2a7700498a0c72d67053eeabfaa39b">kd</a> * (error_diff / dt_sec);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="comment">// Combine PID terms</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordtype">float</span> pid_output = p_term + i_term + d_term;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">// Store for status reporting</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a7ee3645e7fbff18ef6fda7446dab21bd">history</a>.<a class="code" href="../../d5/d2c/structControlHistory__t.html#a185608b989603067ccc8f97f88a3965f">last_pid_output</a> = pid_output;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">return</span> pid_output;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;}</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#ace405738f9ea0b1023b6fcd8a636d093">  429</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../dc/da4/position__control_8c.html#ace405738f9ea0b1023b6fcd8a636d093">calculate_feedforward_output</a>(<a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl,</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                                          uint32_t target_velocity,</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                                          uint32_t dt_ms) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordtype">float</span> velocity_ff =</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a6b4144b9819542bcd46d917883060d8a">feedforward</a>.<a class="code" href="../../d2/de8/structFeedforwardController__t.html#ad18eb49002c9378afbd0427a257f68ec">velocity_gain</a> * (float)target_velocity;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="comment">// Calculate acceleration feedforward</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordtype">float</span> accel_ff = 0.0f;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">if</span> (dt_ms &gt; 0) {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="keywordtype">float</span> dt_sec = (float)dt_ms / 1000.0f;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordtype">float</span> velocity_diff =</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            (float)target_velocity - ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a7ee3645e7fbff18ef6fda7446dab21bd">history</a>.<a class="code" href="../../d5/d2c/structControlHistory__t.html#aa8563cd65614e996a108c1fcfaa57b0b">last_target_velocity</a>;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordtype">float</span> acceleration = velocity_diff / dt_sec;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        accel_ff = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a6b4144b9819542bcd46d917883060d8a">feedforward</a>.<a class="code" href="../../d2/de8/structFeedforwardController__t.html#a1da238881ba0ed98f6977034391fbe5a">acceleration_gain</a> * acceleration;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">// Friction compensation (simple model)</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordtype">float</span> friction_ff = 0.0f;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">if</span> (target_velocity != 0) {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        friction_ff = (target_velocity &gt; 0)</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                          ? ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a6b4144b9819542bcd46d917883060d8a">feedforward</a>.<a class="code" href="../../d2/de8/structFeedforwardController__t.html#ab94fa9f23d37c3c6541733120ec23048">friction_compensation</a></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                          : -ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a6b4144b9819542bcd46d917883060d8a">feedforward</a>.<a class="code" href="../../d2/de8/structFeedforwardController__t.html#ab94fa9f23d37c3c6541733120ec23048">friction_compensation</a>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordtype">float</span> feedforward_output = velocity_ff + accel_ff + friction_ff;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">// Store for status reporting</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a7ee3645e7fbff18ef6fda7446dab21bd">history</a>.<a class="code" href="../../d5/d2c/structControlHistory__t.html#a38c5f33e548b17107bdeb1381af88fe9">last_feedforward_output</a> = feedforward_output;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a7ee3645e7fbff18ef6fda7446dab21bd">history</a>.<a class="code" href="../../d5/d2c/structControlHistory__t.html#aa8563cd65614e996a108c1fcfaa57b0b">last_target_velocity</a> = (float)target_velocity;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">return</span> feedforward_output;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;}</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a54b590c5c09205e845046da05e5953f2">  465</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../dc/da4/position__control_8c.html#a54b590c5c09205e845046da05e5953f2">apply_output_limits</a>(<a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl, <span class="keywordtype">float</span> output) {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">if</span> (output &gt; ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a6c7efae90d78be4106a9cd604b6f291c">output_limit</a>) {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">return</span> ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a6c7efae90d78be4106a9cd604b6f291c">output_limit</a>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (output &lt; -ctrl-&gt;pid.output_limit) {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keywordflow">return</span> -ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">pid</a>.<a class="code" href="../../d4/dff/structPIDController__t.html#a6c7efae90d78be4106a9cd604b6f291c">output_limit</a>;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160; </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">return</span> output;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;}</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a117e7d808d57f0bc0e3bf92c569fcae9">  478</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#a117e7d808d57f0bc0e3bf92c569fcae9">send_motor_command</a>(uint8_t motor_id, <span class="keywordtype">float</span> output) {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="comment">// Convert output to motor velocity command</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    int32_t motor_velocity = (int32_t)output;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="comment">// Apply safety limits</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">if</span> (abs(motor_velocity) &gt; <a class="code" href="../../de/d58/motor__config_8h.html#a28d8a416ec448cfade8aca6ec9a58444">MOTOR_MAX_SPEED</a>) {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        motor_velocity =</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            (motor_velocity &gt; 0) ? <a class="code" href="../../de/d58/motor__config_8h.html#a28d8a416ec448cfade8aca6ec9a58444">MOTOR_MAX_SPEED</a> : -<a class="code" href="../../de/d58/motor__config_8h.html#a28d8a416ec448cfade8aca6ec9a58444">MOTOR_MAX_SPEED</a>;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="comment">// Send command to L6470 driver</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d0/dba/position__control_8h.html#a668947227a7558c7e8e336d4231cb5a1">motor_set_velocity</a>(motor_id, motor_velocity);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;}</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#aadb57d32bcfb4b041904b7b213b83191">  495</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/da4/position__control_8c.html#aadb57d32bcfb4b041904b7b213b83191">update_control_history</a>(<a class="code" href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a> *ctrl) {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a7ee3645e7fbff18ef6fda7446dab21bd">history</a>.<a class="code" href="../../d5/d2c/structControlHistory__t.html#a582b1984d7fc51f40299aacafb4c21f6">last_position</a> = ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#ac1b662cfe97ce5095085584029e58b8d">current_position</a>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#a7ee3645e7fbff18ef6fda7446dab21bd">history</a>.<a class="code" href="../../d5/d2c/structControlHistory__t.html#a16c4937c2ffd9598fd75da9150dd5409">last_error</a> = (float)ctrl-&gt;<a class="code" href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">state</a>.<a class="code" href="../../d6/d57/structControlState__t.html#a43bd62301b102cdd644f81af386a7326">position_error</a>;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00503"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a4f9b03e439d6601bdd135177c53d0d39">  503</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#a4f9b03e439d6601bdd135177c53d0d39">perform_limit_switch_homing</a>(uint8_t motor_id,</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                                                 <a class="code" href="../../da/d77/structHomingConfig__t.html">HomingConfig_t</a> *config) {</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">// Implementation would depend on limit switch hardware</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="comment">// This is a simplified version</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">// Move towards home switch at homing speed</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> result =</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <a class="code" href="../../d0/dba/position__control_8h.html#ada56e0f555c0fa2f2975fd39ec7bed6c">motor_run</a>(motor_id, config-&gt;<a class="code" href="../../da/d77/structHomingConfig__t.html#a5982ce7171b6241af1f46023ee23e572">search_direction</a>, config-&gt;<a class="code" href="../../da/d77/structHomingConfig__t.html#a1998be0d02f0a8aed6df831b77baa649">search_speed</a>);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>) {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    }</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="comment">// Wait for limit switch activation (would need actual hardware interface)</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    uint32_t timeout = <a class="code" href="../../d6/dee/hal__abstraction_8h.html#a38c8c73e78204b0e1248f225a4e0eb50">HAL_Abstraction_GetTick</a>() + config-&gt;<a class="code" href="../../da/d77/structHomingConfig__t.html#af7b290c9b3303ecfd303a1ae96f7906b">timeout_ms</a>;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordtype">bool</span> switch_found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="../../d6/dee/hal__abstraction_8h.html#a38c8c73e78204b0e1248f225a4e0eb50">HAL_Abstraction_GetTick</a>() &lt; timeout &amp;&amp; !switch_found) {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="comment">// Check limit switch state (placeholder)</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        switch_found = <a class="code" href="../../dc/da4/position__control_8c.html#a9bc07c780a72962a6f64022bd1f8c316">check_limit_switch</a>(motor_id);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <a class="code" href="../../d6/dee/hal__abstraction_8h.html#a6e6fd27b95289c06b634c3d03ace0b6e">HAL_Abstraction_Delay</a>(10);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">if</span> (!switch_found) {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <a class="code" href="../../d0/dba/position__control_8h.html#a93c9c6b7036370102e4bdb273c434b90">motor_stop</a>(motor_id);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d0/dba/position__control_8h.html#a4054c19598d7ede707bce0088e462f93">ERROR_HOMING_TIMEOUT</a>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="comment">// Stop motor</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <a class="code" href="../../d0/dba/position__control_8h.html#a93c9c6b7036370102e4bdb273c434b90">motor_stop</a>(motor_id);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="comment">// Back off from switch</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    result =</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <a class="code" href="../../d0/dba/position__control_8h.html#ada56e0f555c0fa2f2975fd39ec7bed6c">motor_run</a>(motor_id, -config-&gt;<a class="code" href="../../da/d77/structHomingConfig__t.html#a5982ce7171b6241af1f46023ee23e572">search_direction</a>, config-&gt;<a class="code" href="../../da/d77/structHomingConfig__t.html#a369437ea0cb24879c25dabc370f184f8">backoff_speed</a>);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>) {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="comment">// Wait for switch to deactivate</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <a class="code" href="../../d6/dee/hal__abstraction_8h.html#a6e6fd27b95289c06b634c3d03ace0b6e">HAL_Abstraction_Delay</a>(config-&gt;<a class="code" href="../../da/d77/structHomingConfig__t.html#abe59ea41bdea76ca32a09f51e7bb287f">backoff_distance</a>);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <a class="code" href="../../d0/dba/position__control_8h.html#a93c9c6b7036370102e4bdb273c434b90">motor_stop</a>(motor_id);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;}</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a49190ef760e7b0cd28f56d3908db5e10">  550</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#a49190ef760e7b0cd28f56d3908db5e10">perform_encoder_index_homing</a>(uint8_t motor_id,</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                                                  <a class="code" href="../../da/d77/structHomingConfig__t.html">HomingConfig_t</a> *config) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">// Implementation would use encoder index pulse</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">// This is a placeholder implementation</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="comment">// Reset encoder position to zero at index</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d0/dba/position__control_8h.html#a020ba343f67f0c0df936e8ac46657973">as5600_set_zero_position</a>(motor_id, 0.0f);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;}</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a09879579977fed59d371b825ab933eb5">  562</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> <a class="code" href="../../dc/da4/position__control_8c.html#a09879579977fed59d371b825ab933eb5">perform_current_position_homing</a>(uint8_t motor_id,</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                                                     <a class="code" href="../../da/d77/structHomingConfig__t.html">HomingConfig_t</a> *config) {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="comment">// Simply set current position as home</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    int32_t current_pos;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a> result = <a class="code" href="../../dc/da4/position__control_8c.html#a763c7a687700d7f95c9cf8a3c96f5583">read_encoder_position</a>(motor_id, &amp;current_pos);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">if</span> (result == <a class="code" href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a>) {</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="comment">// Set encoder offset so current position becomes home_offset</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="comment">// This would require encoder calibration</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;}</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno"><a class="line" href="../../dc/da4/position__control_8c.html#a9bc07c780a72962a6f64022bd1f8c316">  579</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="../../dc/da4/position__control_8c.html#a9bc07c780a72962a6f64022bd1f8c316">check_limit_switch</a>(uint8_t motor_id) {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="comment">// Placeholder - would read actual limit switch GPIO</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;}</div>
<div class="ttc" id="aas5600__driver_8h_html"><div class="ttname"><a href="../../de/d2b/as5600__driver_8h.html">as5600_driver.h</a></div><div class="ttdoc">AS5600 Magnetic Encoder Driver Header.</div></div>
<div class="ttc" id="aerror__codes_8h_html_ad18804b039d93258aac27507b1ad3756"><div class="ttname"><a href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756">SystemError_t</a></div><div class="ttdeci">SystemError_t</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d11/error__codes_8h_source.html#l00048">error_codes.h:48</a></div></div>
<div class="ttc" id="aerror__codes_8h_html_ad18804b039d93258aac27507b1ad3756a6ac534e278ae408341dfc83c9d3a063f"><div class="ttname"><a href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756a6ac534e278ae408341dfc83c9d3a063f">ERROR_MOTOR_INVALID_ID</a></div><div class="ttdeci">@ ERROR_MOTOR_INVALID_ID</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d11/error__codes_8h_source.html#l00105">error_codes.h:105</a></div></div>
<div class="ttc" id="aerror__codes_8h_html_ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70"><div class="ttname"><a href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756abf6cd78c882f75ba696b76d0c77e3e70">SYSTEM_OK</a></div><div class="ttdeci">@ SYSTEM_OK</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d11/error__codes_8h_source.html#l00050">error_codes.h:50</a></div></div>
<div class="ttc" id="aerror__codes_8h_html_ad18804b039d93258aac27507b1ad3756aeae4b12e06d727d085f75f79a820f2e8"><div class="ttname"><a href="../../de/d11/error__codes_8h.html#ad18804b039d93258aac27507b1ad3756aeae4b12e06d727d085f75f79a820f2e8">ERROR_INVALID_PARAMETER</a></div><div class="ttdeci">@ ERROR_INVALID_PARAMETER</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d11/error__codes_8h_source.html#l00055">error_codes.h:54</a></div></div>
<div class="ttc" id="afault__monitor_8h_html"><div class="ttname"><a href="../../df/d2b/fault__monitor_8h.html">fault_monitor.h</a></div><div class="ttdoc">Fault Detection and Monitoring System Interface - STM32H753ZI Stepper Motor Project.</div></div>
<div class="ttc" id="afault__monitor_8h_html_a2db4dddbfc701ca63d8e6449e5453d9c"><div class="ttname"><a href="../../df/d2b/fault__monitor_8h.html#a2db4dddbfc701ca63d8e6449e5453d9c">FAULT_ENCODER_COMMUNICATION</a></div><div class="ttdeci">#define FAULT_ENCODER_COMMUNICATION</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d2b/fault__monitor_8h_source.html#l00176">fault_monitor.h:176</a></div></div>
<div class="ttc" id="afault__monitor_8h_html_a8b6c4b8342f0cfcc176682aa2c0e6a0c"><div class="ttname"><a href="../../df/d2b/fault__monitor_8h.html#a8b6c4b8342f0cfcc176682aa2c0e6a0c">FAULT_POSITION_ERROR_EXCESSIVE</a></div><div class="ttdeci">#define FAULT_POSITION_ERROR_EXCESSIVE</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d2b/fault__monitor_8h_source.html#l00177">fault_monitor.h:177</a></div></div>
<div class="ttc" id="afault__monitor_8h_html_ab9778577bce2d2a4efe52d79b03c0c5d"><div class="ttname"><a href="../../df/d2b/fault__monitor_8h.html#ab9778577bce2d2a4efe52d79b03c0c5d">fault_monitor_report_fault</a></div><div class="ttdeci">SystemError_t fault_monitor_report_fault(uint8_t motor_id, MotorFaultType_t fault_type)</div><div class="ttdoc">Report a motor fault (convenience wrapper)</div></div>
<div class="ttc" id="ahal__abstraction_8h_html"><div class="ttname"><a href="../../d6/dee/hal__abstraction_8h.html">hal_abstraction.h</a></div><div class="ttdoc">Hardware Abstraction Layer (HAL) Interface for STM32H753ZI.</div></div>
<div class="ttc" id="ahal__abstraction_8h_html_a38c8c73e78204b0e1248f225a4e0eb50"><div class="ttname"><a href="../../d6/dee/hal__abstraction_8h.html#a38c8c73e78204b0e1248f225a4e0eb50">HAL_Abstraction_GetTick</a></div><div class="ttdeci">uint32_t HAL_Abstraction_GetTick(void)</div><div class="ttdoc">Get system tick count in milliseconds.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d49/hal__abstraction__stm32h7_8c_source.html#l00532">hal_abstraction_stm32h7.c:532</a></div></div>
<div class="ttc" id="ahal__abstraction_8h_html_a6e6fd27b95289c06b634c3d03ace0b6e"><div class="ttname"><a href="../../d6/dee/hal__abstraction_8h.html#a6e6fd27b95289c06b634c3d03ace0b6e">HAL_Abstraction_Delay</a></div><div class="ttdeci">void HAL_Abstraction_Delay(uint32_t delay_ms)</div><div class="ttdoc">Blocking delay in milliseconds.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d49/hal__abstraction__stm32h7_8c_source.html#l00536">hal_abstraction_stm32h7.c:536</a></div></div>
<div class="ttc" id="ahardware__config_8h_html_a2f2edf5b882e1d4a24e568957fd86246"><div class="ttname"><a href="../../d3/d91/hardware__config_8h.html#a2f2edf5b882e1d4a24e568957fd86246">MAX_POSITION_ERROR_STEPS</a></div><div class="ttdeci">#define MAX_POSITION_ERROR_STEPS</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d91/hardware__config_8h_source.html#l00398">hardware_config.h:398</a></div></div>
<div class="ttc" id="amotion__profile_8c_html_a80b846f20fe162e676d1cc4e20574199"><div class="ttname"><a href="../../d2/de7/motion__profile_8c.html#a80b846f20fe162e676d1cc4e20574199">motion_profile_is_active</a></div><div class="ttdeci">bool motion_profile_is_active(uint8_t motor_id)</div><div class="ttdoc">Check if motion profile is active for motor.</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de7/motion__profile_8c_source.html#l00374">motion_profile.c:374</a></div></div>
<div class="ttc" id="amotion__profile_8c_html_ad59259d434366c76b8611397fd790d42"><div class="ttname"><a href="../../d2/de7/motion__profile_8c.html#ad59259d434366c76b8611397fd790d42">motion_profile_get_status</a></div><div class="ttdeci">SystemError_t motion_profile_get_status(uint8_t motor_id, MotionProfileStatus_t *status)</div><div class="ttdoc">Get current motion profile status.</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de7/motion__profile_8c_source.html#l00388">motion_profile.c:388</a></div></div>
<div class="ttc" id="amotion__profile_8h_html"><div class="ttname"><a href="../../df/d07/motion__profile_8h.html">motion_profile.h</a></div><div class="ttdoc">Advanced Motion Profiling Header for STM32H753ZI Motor Control.</div></div>
<div class="ttc" id="amotor__config_8h_html"><div class="ttname"><a href="../../de/d58/motor__config_8h.html">motor_config.h</a></div><div class="ttdoc">Motor and L6470 Driver Configuration - Single Source of Truth (SSOT)</div></div>
<div class="ttc" id="amotor__config_8h_html_a0a8a9d31c5e91084e3821e23d35af5de"><div class="ttname"><a href="../../de/d58/motor__config_8h.html#a0a8a9d31c5e91084e3821e23d35af5de">MOTOR_MAX_ACCELERATION</a></div><div class="ttdeci">#define MOTOR_MAX_ACCELERATION</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d58/motor__config_8h_source.html#l00182">motor_config.h:182</a></div></div>
<div class="ttc" id="amotor__config_8h_html_a28d8a416ec448cfade8aca6ec9a58444"><div class="ttname"><a href="../../de/d58/motor__config_8h.html#a28d8a416ec448cfade8aca6ec9a58444">MOTOR_MAX_SPEED</a></div><div class="ttdeci">#define MOTOR_MAX_SPEED</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d58/motor__config_8h_source.html#l00181">motor_config.h:181</a></div></div>
<div class="ttc" id="amotor__config_8h_html_a40dfd7fdfce455ce507bf3fed368c2ed"><div class="ttname"><a href="../../de/d58/motor__config_8h.html#a40dfd7fdfce455ce507bf3fed368c2ed">MAX_MOTORS</a></div><div class="ttdeci">#define MAX_MOTORS</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d58/motor__config_8h_source.html#l00026">motor_config.h:26</a></div></div>
<div class="ttc" id="amotor__config_8h_html_abf55bbaef296f1119be253019fc208d9"><div class="ttname"><a href="../../de/d58/motor__config_8h.html#abf55bbaef296f1119be253019fc208d9">MOTOR_STEPS_PER_REV</a></div><div class="ttdeci">#define MOTOR_STEPS_PER_REV</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d58/motor__config_8h_source.html#l00065">motor_config.h:65</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a095abd40d44cddc26583de9affb78e40"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a095abd40d44cddc26583de9affb78e40">calculate_pid_output</a></div><div class="ttdeci">static float calculate_pid_output(PositionControl_t *ctrl, uint32_t dt_ms)</div><div class="ttdoc">Calculate PID output.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00391">position_control.c:391</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a09879579977fed59d371b825ab933eb5"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a09879579977fed59d371b825ab933eb5">perform_current_position_homing</a></div><div class="ttdeci">static SystemError_t perform_current_position_homing(uint8_t motor_id, HomingConfig_t *homing_config)</div><div class="ttdoc">Perform current position homing.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00562">position_control.c:562</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a117e7d808d57f0bc0e3bf92c569fcae9"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a117e7d808d57f0bc0e3bf92c569fcae9">send_motor_command</a></div><div class="ttdeci">static SystemError_t send_motor_command(uint8_t motor_id, float output)</div><div class="ttdoc">Send motor command.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00478">position_control.c:478</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a20e9bdf8668ebd21b208c00c9550ca04"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a20e9bdf8668ebd21b208c00c9550ca04">position_control_set_target</a></div><div class="ttdeci">SystemError_t position_control_set_target(uint8_t motor_id, int32_t target_position)</div><div class="ttdoc">Set target position for motor.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00210">position_control.c:210</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a2b1683f4bab80c7b1e55466c8668548b"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a2b1683f4bab80c7b1e55466c8668548b">controller_initialized</a></div><div class="ttdeci">static bool controller_initialized[MAX_MOTORS]</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00050">position_control.c:50</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a3b3cbeeaa7fdb973fb71dffedd78c668"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a3b3cbeeaa7fdb973fb71dffedd78c668">position_control_home</a></div><div class="ttdeci">SystemError_t position_control_home(uint8_t motor_id, HomingConfig_t *homing_config)</div><div class="ttdoc">Perform homing sequence for motor.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00262">position_control.c:262</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a420cf63344eb43cb92af724ee1b0d16e"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a420cf63344eb43cb92af724ee1b0d16e">position_control_get_status</a></div><div class="ttdeci">SystemError_t position_control_get_status(uint8_t motor_id, PositionControlStatus_t *status)</div><div class="ttdoc">Get position control status.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00312">position_control.c:312</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a49190ef760e7b0cd28f56d3908db5e10"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a49190ef760e7b0cd28f56d3908db5e10">perform_encoder_index_homing</a></div><div class="ttdeci">static SystemError_t perform_encoder_index_homing(uint8_t motor_id, HomingConfig_t *homing_config)</div><div class="ttdoc">Perform encoder index homing.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00550">position_control.c:550</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a4f9b03e439d6601bdd135177c53d0d39"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a4f9b03e439d6601bdd135177c53d0d39">perform_limit_switch_homing</a></div><div class="ttdeci">static SystemError_t perform_limit_switch_homing(uint8_t motor_id, HomingConfig_t *homing_config)</div><div class="ttdoc">Perform limit switch homing.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00503">position_control.c:503</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a54b590c5c09205e845046da05e5953f2"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a54b590c5c09205e845046da05e5953f2">apply_output_limits</a></div><div class="ttdeci">static float apply_output_limits(PositionControl_t *ctrl, float output)</div><div class="ttdoc">Apply output limits.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00465">position_control.c:465</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a6d45acd4b190d726e2f188a1f211d11c"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a6d45acd4b190d726e2f188a1f211d11c">position_control_init</a></div><div class="ttdeci">SystemError_t position_control_init(void)</div><div class="ttdoc">Initialize position control system.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00056">position_control.c:56</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a705389210072ceb00b3c38cb4a55e0bb"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a705389210072ceb00b3c38cb4a55e0bb">position_controllers</a></div><div class="ttdeci">static PositionControl_t position_controllers[MAX_MOTORS]</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00049">position_control.c:49</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a763c7a687700d7f95c9cf8a3c96f5583"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a763c7a687700d7f95c9cf8a3c96f5583">read_encoder_position</a></div><div class="ttdeci">static SystemError_t read_encoder_position(uint8_t motor_id, int32_t *position)</div><div class="ttdoc">Read encoder position with error handling.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00341">position_control.c:341</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a98422e982bfa9adad8d106cb2a73af1c"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a98422e982bfa9adad8d106cb2a73af1c">calculate_velocity</a></div><div class="ttdeci">static void calculate_velocity(PositionControl_t *ctrl, uint32_t dt_ms)</div><div class="ttdoc">Calculate velocity from position difference.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00371">position_control.c:371</a></div></div>
<div class="ttc" id="aposition__control_8c_html_a9bc07c780a72962a6f64022bd1f8c316"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#a9bc07c780a72962a6f64022bd1f8c316">check_limit_switch</a></div><div class="ttdeci">static bool check_limit_switch(uint8_t motor_id)</div><div class="ttdoc">Check limit switch state (placeholder)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00579">position_control.c:579</a></div></div>
<div class="ttc" id="aposition__control_8c_html_aadb57d32bcfb4b041904b7b213b83191"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#aadb57d32bcfb4b041904b7b213b83191">update_control_history</a></div><div class="ttdeci">static void update_control_history(PositionControl_t *ctrl)</div><div class="ttdoc">Update control history.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00495">position_control.c:495</a></div></div>
<div class="ttc" id="aposition__control_8c_html_ab3b0d9cb2203bdfd86d4e0db5737f954"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#ab3b0d9cb2203bdfd86d4e0db5737f954">position_control_enable</a></div><div class="ttdeci">SystemError_t position_control_enable(uint8_t motor_id, bool enable)</div><div class="ttdoc">Enable/disable position control for motor.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00234">position_control.c:234</a></div></div>
<div class="ttc" id="aposition__control_8c_html_ab512f90f1df8ee9d95f6a00b3241c6c6"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#ab512f90f1df8ee9d95f6a00b3241c6c6">position_control_init_motor</a></div><div class="ttdeci">SystemError_t position_control_init_motor(uint8_t motor_id)</div><div class="ttdoc">Initialize position controller for specific motor.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00077">position_control.c:77</a></div></div>
<div class="ttc" id="aposition__control_8c_html_ac71d46770c357b533957c709fa081fb9"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#ac71d46770c357b533957c709fa081fb9">apply_position_filter</a></div><div class="ttdeci">static void apply_position_filter(PositionControl_t *ctrl)</div><div class="ttdoc">Apply position filtering.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00360">position_control.c:360</a></div></div>
<div class="ttc" id="aposition__control_8c_html_ace405738f9ea0b1023b6fcd8a636d093"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#ace405738f9ea0b1023b6fcd8a636d093">calculate_feedforward_output</a></div><div class="ttdeci">static float calculate_feedforward_output(PositionControl_t *ctrl, uint32_t target_velocity, uint32_t dt_ms)</div><div class="ttdoc">Calculate feedforward output.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00429">position_control.c:429</a></div></div>
<div class="ttc" id="aposition__control_8c_html_af170ceb5af2fca6d2388a020b7e3efab"><div class="ttname"><a href="../../dc/da4/position__control_8c.html#af170ceb5af2fca6d2388a020b7e3efab">position_control_update</a></div><div class="ttdeci">SystemError_t position_control_update(uint8_t motor_id, uint32_t dt_ms)</div><div class="ttdoc">Update position control loop for specified motor.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da4/position__control_8c_source.html#l00127">position_control.c:127</a></div></div>
<div class="ttc" id="aposition__control_8h_html"><div class="ttname"><a href="../../d0/dba/position__control_8h.html">position_control.h</a></div><div class="ttdoc">Advanced Position Control with Encoder Feedback - Header.</div></div>
<div class="ttc" id="aposition__control_8h_html_a020ba343f67f0c0df936e8ac46657973"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a020ba343f67f0c0df936e8ac46657973">as5600_set_zero_position</a></div><div class="ttdeci">SystemError_t as5600_set_zero_position(uint8_t encoder_id, float zero_position_deg)</div><div class="ttdoc">Set encoder zero position reference.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d75/as5600__driver_8c_source.html#l00420">as5600_driver.c:420</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a0260fb6f0e1113415bd50bf21ff3dc40a43006555caecb264f48dacf4dfd46475"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a0260fb6f0e1113415bd50bf21ff3dc40a43006555caecb264f48dacf4dfd46475">HOMING_METHOD_LIMIT_SWITCH</a></div><div class="ttdeci">@ HOMING_METHOD_LIMIT_SWITCH</div><div class="ttdoc">Use limit switch for homing.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00049">position_control.h:49</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a0260fb6f0e1113415bd50bf21ff3dc40a8e71ee9cf368c3a9c91fb07232d77481"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a0260fb6f0e1113415bd50bf21ff3dc40a8e71ee9cf368c3a9c91fb07232d77481">HOMING_METHOD_ENCODER_INDEX</a></div><div class="ttdeci">@ HOMING_METHOD_ENCODER_INDEX</div><div class="ttdoc">Use encoder index pulse.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00050">position_control.h:50</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a0260fb6f0e1113415bd50bf21ff3dc40a957d4d49774fce43e66a28fbcec36bc9"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a0260fb6f0e1113415bd50bf21ff3dc40a957d4d49774fce43e66a28fbcec36bc9">HOMING_METHOD_CURRENT_POSITION</a></div><div class="ttdeci">@ HOMING_METHOD_CURRENT_POSITION</div><div class="ttdoc">Set current position as home.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00052">position_control.h:51</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a1a5da372bddcb3ae03c10bd52956f620"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a1a5da372bddcb3ae03c10bd52956f620">VELOCITY_FILTER_ALPHA</a></div><div class="ttdeci">#define VELOCITY_FILTER_ALPHA</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00025">position_control.h:25</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a2b8b31e7da7d9fd2a4a6bd30bec2b17c"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a2b8b31e7da7d9fd2a4a6bd30bec2b17c">FEEDFORWARD_VEL_GAIN</a></div><div class="ttdeci">#define FEEDFORWARD_VEL_GAIN</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00035">position_control.h:35</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a3434b6ac3248cad40560528dcbc51b1a"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a3434b6ac3248cad40560528dcbc51b1a">ERROR_POSITION_ERROR_EXCESSIVE</a></div><div class="ttdeci">#define ERROR_POSITION_ERROR_EXCESSIVE</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00040">position_control.h:40</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a4054c19598d7ede707bce0088e462f93"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a4054c19598d7ede707bce0088e462f93">ERROR_HOMING_TIMEOUT</a></div><div class="ttdeci">#define ERROR_HOMING_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00042">position_control.h:42</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a4095ca74f14971350013a72adfecaabe"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a4095ca74f14971350013a72adfecaabe">VELOCITY_SETTLED_THRESHOLD</a></div><div class="ttdeci">#define VELOCITY_SETTLED_THRESHOLD</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00022">position_control.h:22</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a4ec081867aed740755f68feaa50ecc47"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a4ec081867aed740755f68feaa50ecc47">PID_INTEGRAL_LIMIT</a></div><div class="ttdeci">#define PID_INTEGRAL_LIMIT</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00031">position_control.h:31</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a61476935076615227a674d21e59f057a"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a61476935076615227a674d21e59f057a">POSITION_SETTLED_THRESHOLD</a></div><div class="ttdeci">#define POSITION_SETTLED_THRESHOLD</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00021">position_control.h:21</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a668947227a7558c7e8e336d4231cb5a1"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a668947227a7558c7e8e336d4231cb5a1">motor_set_velocity</a></div><div class="ttdeci">SystemError_t motor_set_velocity(uint8_t motor_id, int32_t velocity)</div></div>
<div class="ttc" id="aposition__control_8h_html_a699c67c6959d9c0134ee91ed365fca4c"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a699c67c6959d9c0134ee91ed365fca4c">PID_OUTPUT_LIMIT</a></div><div class="ttdeci">#define PID_OUTPUT_LIMIT</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00032">position_control.h:32</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a6a06a31b7d815ec8a2fd80e6fb7db9f0"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a6a06a31b7d815ec8a2fd80e6fb7db9f0">FEEDFORWARD_ACCEL_GAIN</a></div><div class="ttdeci">#define FEEDFORWARD_ACCEL_GAIN</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00036">position_control.h:36</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a72d6bf77514bb1a953463d2e6922787b"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a72d6bf77514bb1a953463d2e6922787b">PID_KP_DEFAULT</a></div><div class="ttdeci">#define PID_KP_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00028">position_control.h:28</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a87746b211d4bd81c20bc14be3c39a45a"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a87746b211d4bd81c20bc14be3c39a45a">MAX_POSITION_STEPS</a></div><div class="ttdeci">#define MAX_POSITION_STEPS</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00023">position_control.h:23</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a924fd30878e3eeb2332b3e6b2a9b15f6"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a924fd30878e3eeb2332b3e6b2a9b15f6">PID_KI_DEFAULT</a></div><div class="ttdeci">#define PID_KI_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00029">position_control.h:29</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a93c9c6b7036370102e4bdb273c434b90"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a93c9c6b7036370102e4bdb273c434b90">motor_stop</a></div><div class="ttdeci">SystemError_t motor_stop(uint8_t motor_id)</div></div>
<div class="ttc" id="aposition__control_8h_html_a99d2b31d805a81b682ebf2f7d891082a"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a99d2b31d805a81b682ebf2f7d891082a">PID_KD_DEFAULT</a></div><div class="ttdeci">#define PID_KD_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00030">position_control.h:30</a></div></div>
<div class="ttc" id="aposition__control_8h_html_a9da4040f542f11c875f261e5ff94da2f"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#a9da4040f542f11c875f261e5ff94da2f">FEEDFORWARD_FRICTION_COMP</a></div><div class="ttdeci">#define FEEDFORWARD_FRICTION_COMP</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00037">position_control.h:37</a></div></div>
<div class="ttc" id="aposition__control_8h_html_ab512a9478ef4f61dcfe636c2616b8df9"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#ab512a9478ef4f61dcfe636c2616b8df9">as5600_read_angle</a></div><div class="ttdeci">SystemError_t as5600_read_angle(uint8_t motor_id, uint16_t *angle)</div><div class="ttdoc">Read filtered angle from AS5600.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d75/as5600__driver_8c_source.html#l00217">as5600_driver.c:217</a></div></div>
<div class="ttc" id="aposition__control_8h_html_aca1be497a5c032870050b7553aca17a3"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#aca1be497a5c032870050b7553aca17a3">POSITION_FILTER_ALPHA</a></div><div class="ttdeci">#define POSITION_FILTER_ALPHA</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00024">position_control.h:24</a></div></div>
<div class="ttc" id="aposition__control_8h_html_ada56e0f555c0fa2f2975fd39ec7bed6c"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#ada56e0f555c0fa2f2975fd39ec7bed6c">motor_run</a></div><div class="ttdeci">SystemError_t motor_run(uint8_t motor_id, int8_t direction, uint32_t speed)</div></div>
<div class="ttc" id="aposition__control_8h_html_adf88ac31c9920b19ec09f4a74de16514"><div class="ttname"><a href="../../d0/dba/position__control_8h.html#adf88ac31c9920b19ec09f4a74de16514">ERROR_POSITION_OUT_OF_RANGE</a></div><div class="ttdeci">#define ERROR_POSITION_OUT_OF_RANGE</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00041">position_control.h:41</a></div></div>
<div class="ttc" id="asafety__config_8h_html"><div class="ttname"><a href="../../d3/d5c/safety__config_8h.html">safety_config.h</a></div><div class="ttdoc">Safety Configuration - Single Source of Truth (SSOT)</div></div>
<div class="ttc" id="astm32h7xx__hal__def_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../d1/db4/stm32h7xx__hal__def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db4/stm32h7xx__hal__def_8h_source.html#l00021">stm32h7xx_hal_def.h:21</a></div></div>
<div class="ttc" id="astructControlHistory__t_html_a16c4937c2ffd9598fd75da9150dd5409"><div class="ttname"><a href="../../d5/d2c/structControlHistory__t.html#a16c4937c2ffd9598fd75da9150dd5409">ControlHistory_t::last_error</a></div><div class="ttdeci">float last_error</div><div class="ttdoc">Previous error.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00110">position_control.h:110</a></div></div>
<div class="ttc" id="astructControlHistory__t_html_a185608b989603067ccc8f97f88a3965f"><div class="ttname"><a href="../../d5/d2c/structControlHistory__t.html#a185608b989603067ccc8f97f88a3965f">ControlHistory_t::last_pid_output</a></div><div class="ttdeci">float last_pid_output</div><div class="ttdoc">Last PID output.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00111">position_control.h:111</a></div></div>
<div class="ttc" id="astructControlHistory__t_html_a38c5f33e548b17107bdeb1381af88fe9"><div class="ttname"><a href="../../d5/d2c/structControlHistory__t.html#a38c5f33e548b17107bdeb1381af88fe9">ControlHistory_t::last_feedforward_output</a></div><div class="ttdeci">float last_feedforward_output</div><div class="ttdoc">Last feedforward output.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00112">position_control.h:112</a></div></div>
<div class="ttc" id="astructControlHistory__t_html_a582b1984d7fc51f40299aacafb4c21f6"><div class="ttname"><a href="../../d5/d2c/structControlHistory__t.html#a582b1984d7fc51f40299aacafb4c21f6">ControlHistory_t::last_position</a></div><div class="ttdeci">int32_t last_position</div><div class="ttdoc">Previous position.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00109">position_control.h:109</a></div></div>
<div class="ttc" id="astructControlHistory__t_html_aa8563cd65614e996a108c1fcfaa57b0b"><div class="ttname"><a href="../../d5/d2c/structControlHistory__t.html#aa8563cd65614e996a108c1fcfaa57b0b">ControlHistory_t::last_target_velocity</a></div><div class="ttdeci">float last_target_velocity</div><div class="ttdoc">Last target velocity.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00113">position_control.h:113</a></div></div>
<div class="ttc" id="astructControlLimits__t_html_a00e66f878eb1e60d5457b996a5403ce4"><div class="ttname"><a href="../../de/dac/structControlLimits__t.html#a00e66f878eb1e60d5457b996a5403ce4">ControlLimits_t::max_velocity</a></div><div class="ttdeci">uint32_t max_velocity</div><div class="ttdoc">Maximum velocity limit.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00080">position_control.h:80</a></div></div>
<div class="ttc" id="astructControlLimits__t_html_a2b8f697ef4a4741dbbf45caccc23d1c8"><div class="ttname"><a href="../../de/dac/structControlLimits__t.html#a2b8f697ef4a4741dbbf45caccc23d1c8">ControlLimits_t::max_position_error</a></div><div class="ttdeci">int32_t max_position_error</div><div class="ttdoc">Maximum allowed position error.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00079">position_control.h:79</a></div></div>
<div class="ttc" id="astructControlLimits__t_html_a985b4f115e64801107cf1a74a9120bed"><div class="ttname"><a href="../../de/dac/structControlLimits__t.html#a985b4f115e64801107cf1a74a9120bed">ControlLimits_t::max_acceleration</a></div><div class="ttdeci">uint32_t max_acceleration</div><div class="ttdoc">Maximum acceleration limit.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00081">position_control.h:81</a></div></div>
<div class="ttc" id="astructControlState__t_html_a212e3f5edbb70e5890ca8b0f9b160494"><div class="ttname"><a href="../../d6/d57/structControlState__t.html#a212e3f5edbb70e5890ca8b0f9b160494">ControlState_t::homed</a></div><div class="ttdeci">bool homed</div><div class="ttdoc">Homing completed flag.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00094">position_control.h:94</a></div></div>
<div class="ttc" id="astructControlState__t_html_a43bd62301b102cdd644f81af386a7326"><div class="ttname"><a href="../../d6/d57/structControlState__t.html#a43bd62301b102cdd644f81af386a7326">ControlState_t::position_error</a></div><div class="ttdeci">int32_t position_error</div><div class="ttdoc">Position error (target - current)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00090">position_control.h:90</a></div></div>
<div class="ttc" id="astructControlState__t_html_a819bd521fcdaf105f05e83bf016c289a"><div class="ttname"><a href="../../d6/d57/structControlState__t.html#a819bd521fcdaf105f05e83bf016c289a">ControlState_t::filtered_position</a></div><div class="ttdeci">int32_t filtered_position</div><div class="ttdoc">Filtered position.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00091">position_control.h:91</a></div></div>
<div class="ttc" id="astructControlState__t_html_aa36784080e2f5a2bd79aaa5679e03956"><div class="ttname"><a href="../../d6/d57/structControlState__t.html#aa36784080e2f5a2bd79aaa5679e03956">ControlState_t::velocity</a></div><div class="ttdeci">float velocity</div><div class="ttdoc">Current velocity.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00092">position_control.h:92</a></div></div>
<div class="ttc" id="astructControlState__t_html_aa605c090706a7f0b6707c36bf6de7628"><div class="ttname"><a href="../../d6/d57/structControlState__t.html#aa605c090706a7f0b6707c36bf6de7628">ControlState_t::enabled</a></div><div class="ttdeci">bool enabled</div><div class="ttdoc">Control loop enabled flag.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00093">position_control.h:93</a></div></div>
<div class="ttc" id="astructControlState__t_html_aaf1d32c71d7d84d8697094a370859427"><div class="ttname"><a href="../../d6/d57/structControlState__t.html#aaf1d32c71d7d84d8697094a370859427">ControlState_t::target_position</a></div><div class="ttdeci">int32_t target_position</div><div class="ttdoc">Target position.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00089">position_control.h:89</a></div></div>
<div class="ttc" id="astructControlState__t_html_ac1b662cfe97ce5095085584029e58b8d"><div class="ttname"><a href="../../d6/d57/structControlState__t.html#ac1b662cfe97ce5095085584029e58b8d">ControlState_t::current_position</a></div><div class="ttdeci">int32_t current_position</div><div class="ttdoc">Current encoder position.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00088">position_control.h:88</a></div></div>
<div class="ttc" id="astructFeedforwardController__t_html_a1da238881ba0ed98f6977034391fbe5a"><div class="ttname"><a href="../../d2/de8/structFeedforwardController__t.html#a1da238881ba0ed98f6977034391fbe5a">FeedforwardController_t::acceleration_gain</a></div><div class="ttdeci">float acceleration_gain</div><div class="ttdoc">Acceleration feedforward gain.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00071">position_control.h:71</a></div></div>
<div class="ttc" id="astructFeedforwardController__t_html_ab94fa9f23d37c3c6541733120ec23048"><div class="ttname"><a href="../../d2/de8/structFeedforwardController__t.html#ab94fa9f23d37c3c6541733120ec23048">FeedforwardController_t::friction_compensation</a></div><div class="ttdeci">float friction_compensation</div><div class="ttdoc">Static friction compensation.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00072">position_control.h:72</a></div></div>
<div class="ttc" id="astructFeedforwardController__t_html_ad18eb49002c9378afbd0427a257f68ec"><div class="ttname"><a href="../../d2/de8/structFeedforwardController__t.html#ad18eb49002c9378afbd0427a257f68ec">FeedforwardController_t::velocity_gain</a></div><div class="ttdeci">float velocity_gain</div><div class="ttdoc">Velocity feedforward gain.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00070">position_control.h:70</a></div></div>
<div class="ttc" id="astructHomingConfig__t_html"><div class="ttname"><a href="../../da/d77/structHomingConfig__t.html">HomingConfig_t</a></div><div class="ttdoc">Homing configuration structure.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00131">position_control.h:131</a></div></div>
<div class="ttc" id="astructHomingConfig__t_html_a0a79006da4a85264a00f365e858775be"><div class="ttname"><a href="../../da/d77/structHomingConfig__t.html#a0a79006da4a85264a00f365e858775be">HomingConfig_t::method</a></div><div class="ttdeci">HomingMethod_t method</div><div class="ttdoc">Homing method.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00132">position_control.h:132</a></div></div>
<div class="ttc" id="astructHomingConfig__t_html_a1998be0d02f0a8aed6df831b77baa649"><div class="ttname"><a href="../../da/d77/structHomingConfig__t.html#a1998be0d02f0a8aed6df831b77baa649">HomingConfig_t::search_speed</a></div><div class="ttdeci">uint32_t search_speed</div><div class="ttdoc">Homing search speed.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00134">position_control.h:134</a></div></div>
<div class="ttc" id="astructHomingConfig__t_html_a369437ea0cb24879c25dabc370f184f8"><div class="ttname"><a href="../../da/d77/structHomingConfig__t.html#a369437ea0cb24879c25dabc370f184f8">HomingConfig_t::backoff_speed</a></div><div class="ttdeci">uint32_t backoff_speed</div><div class="ttdoc">Backoff speed after switch hit.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00135">position_control.h:135</a></div></div>
<div class="ttc" id="astructHomingConfig__t_html_a41987e557c49e12e42d8175b8529233d"><div class="ttname"><a href="../../da/d77/structHomingConfig__t.html#a41987e557c49e12e42d8175b8529233d">HomingConfig_t::home_offset</a></div><div class="ttdeci">int32_t home_offset</div><div class="ttdoc">Home position offset.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00137">position_control.h:137</a></div></div>
<div class="ttc" id="astructHomingConfig__t_html_a5982ce7171b6241af1f46023ee23e572"><div class="ttname"><a href="../../da/d77/structHomingConfig__t.html#a5982ce7171b6241af1f46023ee23e572">HomingConfig_t::search_direction</a></div><div class="ttdeci">int8_t search_direction</div><div class="ttdoc">Search direction (+1 or -1)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00133">position_control.h:133</a></div></div>
<div class="ttc" id="astructHomingConfig__t_html_abe59ea41bdea76ca32a09f51e7bb287f"><div class="ttname"><a href="../../da/d77/structHomingConfig__t.html#abe59ea41bdea76ca32a09f51e7bb287f">HomingConfig_t::backoff_distance</a></div><div class="ttdeci">uint32_t backoff_distance</div><div class="ttdoc">Backoff distance in steps.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00136">position_control.h:136</a></div></div>
<div class="ttc" id="astructHomingConfig__t_html_af7b290c9b3303ecfd303a1ae96f7906b"><div class="ttname"><a href="../../da/d77/structHomingConfig__t.html#af7b290c9b3303ecfd303a1ae96f7906b">HomingConfig_t::timeout_ms</a></div><div class="ttdeci">uint32_t timeout_ms</div><div class="ttdoc">Homing timeout in milliseconds.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00138">position_control.h:138</a></div></div>
<div class="ttc" id="astructMotionProfileStatus__t_html"><div class="ttname"><a href="../../d1/d63/structMotionProfileStatus__t.html">MotionProfileStatus_t</a></div><div class="ttdoc">Motion profile status.</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d07/motion__profile_8h_source.html#l00102">motion_profile.h:102</a></div></div>
<div class="ttc" id="astructMotionProfileStatus__t_html_a4ec3b77abd3f19eb15cc8658799aa297"><div class="ttname"><a href="../../d1/d63/structMotionProfileStatus__t.html#a4ec3b77abd3f19eb15cc8658799aa297">MotionProfileStatus_t::current_target_velocity</a></div><div class="ttdeci">uint32_t current_target_velocity</div><div class="ttdoc">Current target velocity.</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d07/motion__profile_8h_source.html#l00109">motion_profile.h:109</a></div></div>
<div class="ttc" id="astructMotionProfileStatus__t_html_af50735ad371f2969e4a69fb52c6f4fe7"><div class="ttname"><a href="../../d1/d63/structMotionProfileStatus__t.html#af50735ad371f2969e4a69fb52c6f4fe7">MotionProfileStatus_t::current_target_position</a></div><div class="ttdeci">int32_t current_target_position</div><div class="ttdoc">Current target position.</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d07/motion__profile_8h_source.html#l00108">motion_profile.h:108</a></div></div>
<div class="ttc" id="astructPIDController__t_html_a3ad223e0c4b675e54858a88f90a06f1f"><div class="ttname"><a href="../../d4/dff/structPIDController__t.html#a3ad223e0c4b675e54858a88f90a06f1f">PIDController_t::kp</a></div><div class="ttdeci">float kp</div><div class="ttdoc">Proportional gain.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00058">position_control.h:58</a></div></div>
<div class="ttc" id="astructPIDController__t_html_a560e138364e3a041a8f28f1452a1a8b6"><div class="ttname"><a href="../../d4/dff/structPIDController__t.html#a560e138364e3a041a8f28f1452a1a8b6">PIDController_t::integral_limit</a></div><div class="ttdeci">float integral_limit</div><div class="ttdoc">Integral windup limit.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00062">position_control.h:62</a></div></div>
<div class="ttc" id="astructPIDController__t_html_a60697e647e9ae3ec45ac3cece71578ee"><div class="ttname"><a href="../../d4/dff/structPIDController__t.html#a60697e647e9ae3ec45ac3cece71578ee">PIDController_t::ki</a></div><div class="ttdeci">float ki</div><div class="ttdoc">Integral gain.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00059">position_control.h:59</a></div></div>
<div class="ttc" id="astructPIDController__t_html_a6175c7a4f8511cdfcf545823da64acf9"><div class="ttname"><a href="../../d4/dff/structPIDController__t.html#a6175c7a4f8511cdfcf545823da64acf9">PIDController_t::integral</a></div><div class="ttdeci">float integral</div><div class="ttdoc">Integral accumulator.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00061">position_control.h:61</a></div></div>
<div class="ttc" id="astructPIDController__t_html_a6c7efae90d78be4106a9cd604b6f291c"><div class="ttname"><a href="../../d4/dff/structPIDController__t.html#a6c7efae90d78be4106a9cd604b6f291c">PIDController_t::output_limit</a></div><div class="ttdeci">float output_limit</div><div class="ttdoc">Output saturation limit.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00063">position_control.h:63</a></div></div>
<div class="ttc" id="astructPIDController__t_html_aac2a7700498a0c72d67053eeabfaa39b"><div class="ttname"><a href="../../d4/dff/structPIDController__t.html#aac2a7700498a0c72d67053eeabfaa39b">PIDController_t::kd</a></div><div class="ttdeci">float kd</div><div class="ttdoc">Derivative gain.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00060">position_control.h:60</a></div></div>
<div class="ttc" id="astructPositionControlStatus__t_html"><div class="ttname"><a href="../../df/d9d/structPositionControlStatus__t.html">PositionControlStatus_t</a></div><div class="ttdoc">Position control status structure.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00144">position_control.h:144</a></div></div>
<div class="ttc" id="astructPositionControlStatus__t_html_a057bdfff37ec5993296e39b46e22db64"><div class="ttname"><a href="../../df/d9d/structPositionControlStatus__t.html#a057bdfff37ec5993296e39b46e22db64">PositionControlStatus_t::velocity</a></div><div class="ttdeci">float velocity</div><div class="ttdoc">Current velocity.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00150">position_control.h:150</a></div></div>
<div class="ttc" id="astructPositionControlStatus__t_html_a307170da250523007677eb8865c30e0e"><div class="ttname"><a href="../../df/d9d/structPositionControlStatus__t.html#a307170da250523007677eb8865c30e0e">PositionControlStatus_t::pid_output</a></div><div class="ttdeci">float pid_output</div><div class="ttdoc">Last PID output.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00151">position_control.h:151</a></div></div>
<div class="ttc" id="astructPositionControlStatus__t_html_a61ac4c0eda402996490d78f4340357fc"><div class="ttname"><a href="../../df/d9d/structPositionControlStatus__t.html#a61ac4c0eda402996490d78f4340357fc">PositionControlStatus_t::position_settled</a></div><div class="ttdeci">bool position_settled</div><div class="ttdoc">Position settled flag.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00153">position_control.h:153</a></div></div>
<div class="ttc" id="astructPositionControlStatus__t_html_a67a2c104c93c07b71d5cfc8fc281126d"><div class="ttname"><a href="../../df/d9d/structPositionControlStatus__t.html#a67a2c104c93c07b71d5cfc8fc281126d">PositionControlStatus_t::target_position</a></div><div class="ttdeci">int32_t target_position</div><div class="ttdoc">Target position.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00148">position_control.h:148</a></div></div>
<div class="ttc" id="astructPositionControlStatus__t_html_a6c9e70952f6e39b019910d177a48d9fb"><div class="ttname"><a href="../../df/d9d/structPositionControlStatus__t.html#a6c9e70952f6e39b019910d177a48d9fb">PositionControlStatus_t::current_position</a></div><div class="ttdeci">int32_t current_position</div><div class="ttdoc">Current position.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00147">position_control.h:147</a></div></div>
<div class="ttc" id="astructPositionControlStatus__t_html_a8179e7d88d7c29fee336b8a2bc3d12df"><div class="ttname"><a href="../../df/d9d/structPositionControlStatus__t.html#a8179e7d88d7c29fee336b8a2bc3d12df">PositionControlStatus_t::homed</a></div><div class="ttdeci">bool homed</div><div class="ttdoc">Homing completed.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00146">position_control.h:146</a></div></div>
<div class="ttc" id="astructPositionControlStatus__t_html_ad2f3157c07e9d2ef583ca503b22fa9f9"><div class="ttname"><a href="../../df/d9d/structPositionControlStatus__t.html#ad2f3157c07e9d2ef583ca503b22fa9f9">PositionControlStatus_t::feedforward_output</a></div><div class="ttdeci">float feedforward_output</div><div class="ttdoc">Last feedforward output.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00152">position_control.h:152</a></div></div>
<div class="ttc" id="astructPositionControlStatus__t_html_ae1628b7231e769fb292626988a61f2c3"><div class="ttname"><a href="../../df/d9d/structPositionControlStatus__t.html#ae1628b7231e769fb292626988a61f2c3">PositionControlStatus_t::position_error</a></div><div class="ttdeci">int32_t position_error</div><div class="ttdoc">Position error.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00149">position_control.h:149</a></div></div>
<div class="ttc" id="astructPositionControlStatus__t_html_afe1ab1da481a8e9ad0e08924b8d36484"><div class="ttname"><a href="../../df/d9d/structPositionControlStatus__t.html#afe1ab1da481a8e9ad0e08924b8d36484">PositionControlStatus_t::enabled</a></div><div class="ttdeci">bool enabled</div><div class="ttdoc">Controller enabled.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00145">position_control.h:145</a></div></div>
<div class="ttc" id="astructPositionControl__t_html"><div class="ttname"><a href="../../da/dd6/structPositionControl__t.html">PositionControl_t</a></div><div class="ttdoc">Complete position controller structure.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00119">position_control.h:119</a></div></div>
<div class="ttc" id="astructPositionControl__t_html_a524e4e3fdd4ec0e01e4b2936b31c302b"><div class="ttname"><a href="../../da/dd6/structPositionControl__t.html#a524e4e3fdd4ec0e01e4b2936b31c302b">PositionControl_t::limits</a></div><div class="ttdeci">ControlLimits_t limits</div><div class="ttdoc">Control limits.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00122">position_control.h:122</a></div></div>
<div class="ttc" id="astructPositionControl__t_html_a6b4144b9819542bcd46d917883060d8a"><div class="ttname"><a href="../../da/dd6/structPositionControl__t.html#a6b4144b9819542bcd46d917883060d8a">PositionControl_t::feedforward</a></div><div class="ttdeci">FeedforwardController_t feedforward</div><div class="ttdoc">Feedforward controller.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00121">position_control.h:121</a></div></div>
<div class="ttc" id="astructPositionControl__t_html_a7ee3645e7fbff18ef6fda7446dab21bd"><div class="ttname"><a href="../../da/dd6/structPositionControl__t.html#a7ee3645e7fbff18ef6fda7446dab21bd">PositionControl_t::history</a></div><div class="ttdeci">ControlHistory_t history</div><div class="ttdoc">Control history.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00125">position_control.h:125</a></div></div>
<div class="ttc" id="astructPositionControl__t_html_aba109f7064cc6908c96f541d015a6092"><div class="ttname"><a href="../../da/dd6/structPositionControl__t.html#aba109f7064cc6908c96f541d015a6092">PositionControl_t::filter</a></div><div class="ttdeci">PositionFilter_t filter</div><div class="ttdoc">Filtering parameters.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00124">position_control.h:124</a></div></div>
<div class="ttc" id="astructPositionControl__t_html_ac03c5d02061865817fb9bb5bc072b863"><div class="ttname"><a href="../../da/dd6/structPositionControl__t.html#ac03c5d02061865817fb9bb5bc072b863">PositionControl_t::state</a></div><div class="ttdeci">ControlState_t state</div><div class="ttdoc">Current state.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00123">position_control.h:123</a></div></div>
<div class="ttc" id="astructPositionControl__t_html_ae73342f87031af094619fc0f86ddac0a"><div class="ttname"><a href="../../da/dd6/structPositionControl__t.html#ae73342f87031af094619fc0f86ddac0a">PositionControl_t::pid</a></div><div class="ttdeci">PIDController_t pid</div><div class="ttdoc">PID controller.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00120">position_control.h:120</a></div></div>
<div class="ttc" id="astructPositionFilter__t_html_a1701e6979cd4bb15856f03bf0173dd35"><div class="ttname"><a href="../../d5/d1f/structPositionFilter__t.html#a1701e6979cd4bb15856f03bf0173dd35">PositionFilter_t::position_filter_alpha</a></div><div class="ttdeci">float position_filter_alpha</div><div class="ttdoc">Position filter coefficient.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00101">position_control.h:101</a></div></div>
<div class="ttc" id="astructPositionFilter__t_html_a86d14add504a2faf66d45d6808f38e6d"><div class="ttname"><a href="../../d5/d1f/structPositionFilter__t.html#a86d14add504a2faf66d45d6808f38e6d">PositionFilter_t::velocity_filter_alpha</a></div><div class="ttdeci">float velocity_filter_alpha</div><div class="ttdoc">Velocity filter coefficient.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dba/position__control_8h_source.html#l00102">position_control.h:102</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 11 2025 23:51:09 for STM32H753ZI Motor Control System by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
