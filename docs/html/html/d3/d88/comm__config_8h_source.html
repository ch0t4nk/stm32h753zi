<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM32H753ZI Motor Control System: src/config/comm_config.h Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">STM32H753ZI Motor Control System
   &#160;<span id="projectnumber">v1.0.0</span>
   </div>
   <div id="projectbrief">Advanced stepper motor control with X-CUBE-SPN2 and safety systems</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_7e83d1792d529f4aa7126ac7e0b3b699.html">config</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">comm_config.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d3/d88/comm__config_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#ifndef COMM_CONFIG_H</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#define COMM_CONFIG_H</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">/* Protocol Message Configuration (SSOT)                                     */</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">// Message payload sizes</span></div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a4c78df0dfd8607bcd2e87b5b67227845">   28</a></span>&#160;<span class="preprocessor">#define MAX_MESSAGE_PAYLOAD 128       </span><span class="comment">// Maximum message payload size</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#ifndef MAX_ETH_PAYLOAD</span></div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a4041187e6b5a98c2d367ed1efc7b91ae">   30</a></span>&#160;<span class="preprocessor">#define MAX_ETH_PAYLOAD 1500          </span><span class="comment">// Maximum Ethernet payload (avoid HAL conflict)</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/* UART Communication Configuration (SSOT)                                   */</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">// TODO: See .github/instructions/stm32h7-uart-protocol.instructions.md for</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">// command protocol implementation</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">// UART Parameters</span></div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a2c7ed0283bd6f2f9d791860d6254ef4f">   40</a></span>&#160;<span class="preprocessor">#define UART_BAUDRATE 115200</span></div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a120cc83796f75c76373b5e51c6d5e64f">   41</a></span>&#160;<span class="preprocessor">#define UART_WORD_LENGTH UART_WORDLENGTH_8B</span></div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a5a50a502408c7bea025124b526ca381c">   42</a></span>&#160;<span class="preprocessor">#define UART_STOP_BITS UART_STOPBITS_1</span></div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a40f6d25d96053400829579d41169bb50">   43</a></span>&#160;<span class="preprocessor">#define UART_PARITY UART_PARITY_NONE</span></div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#adcb178ca46800df2e89a5430df663553">   44</a></span>&#160;<span class="preprocessor">#define UART_HW_FLOW_CONTROL UART_HWCONTROL_NONE</span></div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ab2b881cf2de94fa3dc22df0f07300b87">   45</a></span>&#160;<span class="preprocessor">#define UART_MODE UART_MODE_TX_RX</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">// UART Buffer Sizes</span></div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a05f5d709605c6317c97e4974bec3402a">   48</a></span>&#160;<span class="preprocessor">#define UART_TX_BUFFER_SIZE 512</span></div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a5bdd6772c246436bb14377095de79b31">   49</a></span>&#160;<span class="preprocessor">#define UART_RX_BUFFER_SIZE 256</span></div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a55224654172d5191aa3ab6951bb8c028">   50</a></span>&#160;<span class="preprocessor">#define UART_CMD_MAX_LENGTH 64</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">// UART Timeouts (milliseconds)</span></div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a240aa0fe79dd53e1ff75c4c865b4b93d">   53</a></span>&#160;<span class="preprocessor">#define UART_TX_TIMEOUT_MS 100</span></div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a9eb06c53a2ddb30bafb92601d14ca6cf">   54</a></span>&#160;<span class="preprocessor">#define UART_RX_TIMEOUT_MS 1000</span></div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a16ae8e077b6bf7884b0bb62b91e307cd">   55</a></span>&#160;<span class="preprocessor">#define UART_CMD_TIMEOUT_MS 5000</span></div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a6bfddf84ea47d906536cc8ffcc9dd5cc">   56</a></span>&#160;<span class="preprocessor">#define UART_TIMEOUT_MS 1000          </span><span class="comment">// Generic UART timeout</span></div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a69203a09c48674a658d9dd2115d49a67">   57</a></span>&#160;<span class="preprocessor">#define DEBUG_UART_BAUDRATE 115200    </span><span class="comment">// Debug UART baudrate</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">// Protocol Timeouts</span></div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a74d276cabe919fbeb337ea500d90aaa2">   60</a></span>&#160;<span class="preprocessor">#define COMM_DEFAULT_TIMEOUT_MS 5000  </span><span class="comment">// Default communication timeout</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">// UART Command Delimiters</span></div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a5a8c29f00292d7e6374c48384483086b">   63</a></span>&#160;<span class="preprocessor">#define UART_CMD_START_CHAR &#39;{&#39;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a395f1b448c3207dc2d30399add147839">   64</a></span>&#160;<span class="preprocessor">#define UART_CMD_END_CHAR &#39;}&#39;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a307b4ec7a71efef91b571589a4dfe74e">   65</a></span>&#160;<span class="preprocessor">#define UART_CMD_SEPARATOR &#39;,&#39;</span></div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ae94c80aa2499364e5b0f3034bbd9282c">   66</a></span>&#160;<span class="preprocessor">#define UART_RESPONSE_OK &quot;OK&quot;</span></div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a7836ad8d5b8bbadb68bab4d590ffe3eb">   67</a></span>&#160;<span class="preprocessor">#define UART_RESPONSE_ERROR &quot;ERROR&quot;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">/* CAN-FD Communication Configuration (SSOT)                                 */</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">// TODO: See .github/instructions/comm-protocols.instructions.md for message</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">// protocol and error handling</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">// CAN Bit Timing Parameters (500 kbps nominal)</span></div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#aa7b1ff35e2de8ce3a966f16db4366cf0">   76</a></span>&#160;<span class="preprocessor">#define CAN_BITRATE_KBPS 500</span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a8a0f9fa5f6434076707287c9c0ed2581">   77</a></span>&#160;<span class="preprocessor">#define CAN_PRESCALER 12</span></div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a896f6c6a74e089236b62c79c1abbae95">   78</a></span>&#160;<span class="preprocessor">#define CAN_TIME_SEG1 13</span></div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a1a0cc19245fba315932d36391a8e02b6">   79</a></span>&#160;<span class="preprocessor">#define CAN_TIME_SEG2 2</span></div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a63c071259054d819f191ad1be4b61288">   80</a></span>&#160;<span class="preprocessor">#define CAN_SYNC_JUMP_WIDTH 1</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">// CAN-FD Data Phase Timing (2 Mbps data phase)</span></div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#aa9718880a4bf14f3f414d03850de8bad">   83</a></span>&#160;<span class="preprocessor">#define CAN_FD_DATA_BITRATE_KBPS 2000</span></div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ac2429b8bb28dc65cd1ed17c82741ddb2">   84</a></span>&#160;<span class="preprocessor">#define CAN_FD_DATA_PRESCALER 3</span></div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a641a6a16ea848fd4d22d958e3c15c965">   85</a></span>&#160;<span class="preprocessor">#define CAN_FD_DATA_TIME_SEG1 13</span></div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a6c56bae25fc406637371f3d616851399">   86</a></span>&#160;<span class="preprocessor">#define CAN_FD_DATA_TIME_SEG2 2</span></div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#aa581252672e877d531439db909911ab9">   87</a></span>&#160;<span class="preprocessor">#define CAN_FD_DATA_SYNC_JUMP_WIDTH 1</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">// CAN Message Configuration</span></div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ae01b173bf43f63fefd9241f407782072">   90</a></span>&#160;<span class="preprocessor">#define CAN_MAX_MESSAGE_SIZE 64 </span><span class="comment">// CAN-FD max payload</span></div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a1486e60a5b05bafd30602b3e09af52be">   91</a></span>&#160;<span class="preprocessor">#define CAN_MOTOR_BASE_ID 0x100  </span><span class="comment">// Base CAN ID for motor commands</span></div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#adf089531692e0a0c06a2139d4cca0fa7">   92</a></span>&#160;<span class="preprocessor">#define CAN_TIMEOUT_MS 1000      </span><span class="comment">// CAN transmission timeout</span></div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a004f5f33a2f44b1039f0ef013cebd0a0">   93</a></span>&#160;<span class="preprocessor">#define CAN_TX_FIFO_SIZE 16</span></div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a889b00c6130a0b35e5d3ae0d207d5493">   94</a></span>&#160;<span class="preprocessor">#define CAN_RX_FIFO_SIZE 32</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">// CAN Node Configuration</span></div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ae9462fd6c430027c9490d6d69a027afd">   97</a></span>&#160;<span class="preprocessor">#define CAN_NODE_ID 0x01      </span><span class="comment">// This controller&#39;s node ID</span></div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a4460b53933e766c2277bc6100057ae9f">   98</a></span>&#160;<span class="preprocessor">#define CAN_BROADCAST_ID 0x00 </span><span class="comment">// Broadcast messages</span></div>
<div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#af0119046ae8e738a4b67ef11bbd5e9c1">   99</a></span>&#160;<span class="preprocessor">#define CAN_MAX_NODES 16      </span><span class="comment">// Maximum nodes on bus</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">/* CAN Message ID Allocation (SSOT)                                          */</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">// TODO: See .github/instructions/comm-protocols.instructions.md for message</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">// format specification</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">// Base IDs for different message types</span></div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a8a43a5f183e83644ad2a668707b18325">  108</a></span>&#160;<span class="preprocessor">#define CAN_ID_BASE_STATUS 0x100    </span><span class="comment">// Node status messages</span></div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a2b01f2197c7f1166d1c1f826cfe18332">  109</a></span>&#160;<span class="preprocessor">#define CAN_ID_BASE_COMMAND 0x200   </span><span class="comment">// Command messages</span></div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a8a0ff4cd271a33420f99b481dfdff8f4">  110</a></span>&#160;<span class="preprocessor">#define CAN_ID_BASE_DATA 0x300      </span><span class="comment">// Sensor data messages</span></div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a6399f1ed6fa108c05ba5e8a4d3ed76ed">  111</a></span>&#160;<span class="preprocessor">#define CAN_ID_BASE_ERROR 0x400     </span><span class="comment">// Error/fault messages</span></div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#acf57f862609a81e0ac9e72c1930e083d">  112</a></span>&#160;<span class="preprocessor">#define CAN_ID_BASE_HEARTBEAT 0x000 </span><span class="comment">// Heartbeat/sync messages</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">// Specific Message IDs (Node ID is added to base)</span></div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a48bcca3ea710ac522e7649b95e107b4c">  115</a></span>&#160;<span class="preprocessor">#define CAN_ID_MOTOR1_STATUS (CAN_ID_BASE_STATUS + 0x01) </span><span class="comment">// 0x101</span></div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#adb78ce34ac9803b2dd5d32744b44f7a2">  116</a></span>&#160;<span class="preprocessor">#define CAN_ID_MOTOR2_STATUS (CAN_ID_BASE_STATUS + 0x02) </span><span class="comment">// 0x102</span></div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a8428db4b0645be3414a45f2bb376785b">  117</a></span>&#160;<span class="preprocessor">#define CAN_ID_ENCODER1_DATA (CAN_ID_BASE_DATA + 0x01)   </span><span class="comment">// 0x301</span></div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#afa946d05e6d29bd20ffe06f63f3233c4">  118</a></span>&#160;<span class="preprocessor">#define CAN_ID_ENCODER2_DATA (CAN_ID_BASE_DATA + 0x02)   </span><span class="comment">// 0x302</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#aefc879b2edb04da7a9ab6842f10e19a5">  120</a></span>&#160;<span class="preprocessor">#define CAN_ID_MOVE_COMMAND (CAN_ID_BASE_COMMAND + 0x01)  </span><span class="comment">// 0x201</span></div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a34f128814358add6b6178ac2bb070107">  121</a></span>&#160;<span class="preprocessor">#define CAN_ID_STOP_COMMAND (CAN_ID_BASE_COMMAND + 0x02)  </span><span class="comment">// 0x202</span></div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a336ac7f2b0b3394f59b2a6168b56c5ec">  122</a></span>&#160;<span class="preprocessor">#define CAN_ID_CALIBRATE_CMD (CAN_ID_BASE_COMMAND + 0x03) </span><span class="comment">// 0x203</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ae66d1ef5942bfab69f5edd7fa47238d2">  124</a></span>&#160;<span class="preprocessor">#define CAN_ID_MOTOR_FAULT (CAN_ID_BASE_ERROR + 0x01)   </span><span class="comment">// 0x401</span></div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a3f7a7da6f81a35444a91fac1e6834810">  125</a></span>&#160;<span class="preprocessor">#define CAN_ID_ENCODER_FAULT (CAN_ID_BASE_ERROR + 0x02) </span><span class="comment">// 0x402</span></div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#aaef9519343cc322fd7eb8bbe6c2137ff">  126</a></span>&#160;<span class="preprocessor">#define CAN_ID_SYSTEM_FAULT (CAN_ID_BASE_ERROR + 0x03)  </span><span class="comment">// 0x403</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a5be335c6ed54aadd7b671cf755ec883c">  128</a></span>&#160;<span class="preprocessor">#define CAN_ID_HEARTBEAT (CAN_ID_BASE_HEARTBEAT + CAN_NODE_ID) </span><span class="comment">// 0x001</span></div>
<div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#aac53a73b5329974cb33e7ee7884f8ea2">  129</a></span>&#160;<span class="preprocessor">#define CAN_ID_TIME_SYNC (CAN_ID_BASE_HEARTBEAT + 0xFF)        </span><span class="comment">// 0x0FF</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">// CAN Filter Configuration</span></div>
<div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ac799d99bcc36076933676cc326f09757">  132</a></span>&#160;<span class="preprocessor">#define CAN_FILTER_COUNT 8</span></div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#abfbb1f18b0e6a7aa0ac82cc89a2c237a">  133</a></span>&#160;<span class="preprocessor">#define CAN_FILTER_FIFO 0</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">/* Ethernet/TCP Configuration (SSOT)                                         */</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">// TODO: See .github/instructions/comm-protocols.instructions.md for LwIP stack</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">// parameters</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">// Network Configuration</span></div>
<div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ae73d455129460f9ef898b773eadd94fb">  142</a></span>&#160;<span class="preprocessor">#define ETH_STATIC_IP &quot;192.168.1.50&quot;</span></div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a5c802746d710832f49efc98b1b8b5dac">  143</a></span>&#160;<span class="preprocessor">#define ETH_NETMASK &quot;255.255.255.0&quot;</span></div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a1a5b6a796459336acc1515ac3893b07b">  144</a></span>&#160;<span class="preprocessor">#define ETH_GATEWAY &quot;192.168.1.1&quot;</span></div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a4ed6416f8888be04fc5aa7b4395b2814">  145</a></span>&#160;<span class="preprocessor">#define ETH_DNS_SERVER &quot;8.8.8.8&quot;</span></div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#aca3335efd8e9bb6dd7473f46cd1c33bc">  146</a></span>&#160;<span class="preprocessor">#define ETH_MAC_ADDR                                                           \</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor">  { 0x02, 0x00, 0x00, 0x12, 0x34, 0x56 }</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">// TCP Server Configuration</span></div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a5017889290713c7b619c083c9a36addb">  150</a></span>&#160;<span class="preprocessor">#define TCP_SERVER_PORT 8000</span></div>
<div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a27f1c68e5171538b577b562538e8856c">  151</a></span>&#160;<span class="preprocessor">#define TCP_MAX_CONNECTIONS 4</span></div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ac6d48bae36dd4dca0e579cb9e5439eb9">  152</a></span>&#160;<span class="preprocessor">#define TCP_KEEPALIVE_IDLE 7200   </span><span class="comment">// seconds</span></div>
<div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a0dd12e9a698ad6076b09a5368e344de0">  153</a></span>&#160;<span class="preprocessor">#define TCP_KEEPALIVE_INTERVAL 75 </span><span class="comment">// seconds</span></div>
<div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a1fc33fe3ff950f244d1b7f05ac59d1d5">  154</a></span>&#160;<span class="preprocessor">#define TCP_KEEPALIVE_COUNT 9</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">// TCP Buffer Sizes</span></div>
<div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a77d8cd3131176112dbe61ef826cfefed">  157</a></span>&#160;<span class="preprocessor">#define TCP_TX_BUFFER_SIZE 2048</span></div>
<div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a1487678ecda8cb4e006b794e31f959dc">  158</a></span>&#160;<span class="preprocessor">#define TCP_RX_BUFFER_SIZE 1024</span></div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a98b23e7cbd3281915c50a485cb61899d">  159</a></span>&#160;<span class="preprocessor">#define TCP_LISTEN_BACKLOG 5</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">// HTTP Server Configuration (optional)</span></div>
<div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a4f905ddd4da1a3e205a8935f4babb25b">  162</a></span>&#160;<span class="preprocessor">#define HTTP_SERVER_PORT 80</span></div>
<div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a55515a8260b8763f7ce55aa74cc5d4ce">  163</a></span>&#160;<span class="preprocessor">#define HTTP_MAX_URI_LENGTH 256</span></div>
<div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a782bd520332cb7229d92daa8e8f70a01">  164</a></span>&#160;<span class="preprocessor">#define HTTP_MAX_HEADER_LENGTH 512</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">/* I2C Communication Configuration (SSOT)                                    */</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">// TODO: See .github/instructions/stm32h7-i2c-as5600.instructions.md for timing</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">// and error handling</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">// I2C Timing Configuration (400 kHz fast mode)</span></div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ac9e3be1e84c2a6dcee824d9d1c1fc5f7">  173</a></span>&#160;<span class="preprocessor">#define I2C_TIMING_400KHZ 0x40912732 </span><span class="comment">// Calculated for 120MHz APB1</span></div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a794aab92e42970a3980e722d4ac7e1d5">  174</a></span>&#160;<span class="preprocessor">#define I2C_TIMING_100KHZ 0x40C03E5B </span><span class="comment">// Standard mode fallback</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">// I2C Operation Parameters</span></div>
<div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a6d9fec9b374202fa7b38371ead9edc07">  177</a></span>&#160;<span class="preprocessor">#define I2C_MAX_TRANSFER_SIZE 32</span></div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ac8c61bd2fdc391886d8da5c2de78292a">  178</a></span>&#160;<span class="preprocessor">#define I2C_TIMEOUT_MS 1000</span></div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a7a625a27cd09ae70aefbb08680c7236a">  179</a></span>&#160;<span class="preprocessor">#define I2C_RETRY_COUNT 3</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">// I2C Device Addresses (7-bit addresses)</span></div>
<div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a7d20a5ca906a2cd363fea52b6a2c0e68">  182</a></span>&#160;<span class="preprocessor">#define I2C_ADDR_AS5600 0x36 </span><span class="comment">// Magnetic encoder</span></div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a62e4040a0d859e44c9d9fd485ea94549">  183</a></span>&#160;<span class="preprocessor">#define I2C_ADDR_EEPROM 0x50 </span><span class="comment">// Optional calibration storage</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">/* SPI Communication Configuration (SSOT)                                    */</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">// TODO: See .github/instructions/stm32h7-spi-l6470.instructions.md for</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">// daisy-chain protocol timing</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">// SPI Parameters for L6470 Communication</span></div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ac84ff2a9ed48d33675f812d9c1465cb7">  192</a></span>&#160;<span class="preprocessor">#define SPI_BAUDRATE_PRESCALER SPI_BAUDRATEPRESCALER_32 </span><span class="comment">// ~3.75 MHz</span></div>
<div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a24b4ae97ba7cd3a3a71c5978d6c44bb0">  193</a></span>&#160;<span class="preprocessor">#define SPI_DIRECTION SPI_DIRECTION_2LINES</span></div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a47a6a1f5fc9a743461a12091ea5245fb">  194</a></span>&#160;<span class="preprocessor">#define SPI_DATASIZE SPI_DATASIZE_8BIT</span></div>
<div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ad8e335b1f808bd7408d2aef2377adcb1">  195</a></span>&#160;<span class="preprocessor">#define SPI_CPOL SPI_POLARITY_HIGH </span><span class="comment">// CPOL = 1</span></div>
<div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a49e8927a636f45641d6231ac63b9e598">  196</a></span>&#160;<span class="preprocessor">#define SPI_CPHA SPI_PHASE_2EDGE   </span><span class="comment">// CPHA = 1</span></div>
<div class="line"><a name="l00197"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a646eacac2fb42893706748085cb0d54a">  197</a></span>&#160;<span class="preprocessor">#define SPI_NSS SPI_NSS_SOFT</span></div>
<div class="line"><a name="l00198"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#ac8d9eef7eba2ff90fab77df5bd7c15df">  198</a></span>&#160;<span class="preprocessor">#define SPI_FIRST_BIT SPI_FIRSTBIT_MSB</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">// SPI Timing and Buffers</span></div>
<div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a8fe847e1fd705110c6f54ede74af96ea">  201</a></span>&#160;<span class="preprocessor">#define SPI_TIMEOUT_MS 100</span></div>
<div class="line"><a name="l00202"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a9ba877ebaf3862d746379fd8c2ca68f7">  202</a></span>&#160;<span class="preprocessor">#define SPI_MAX_TRANSFER_SIZE 8 </span><span class="comment">// Maximum bytes per transaction</span></div>
<div class="line"><a name="l00203"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a2f1bd731530d8777f303b7d57e25dfc1">  203</a></span>&#160;<span class="preprocessor">#define SPI_CS_SETUP_TIME_US 1  </span><span class="comment">// CS setup time before clock</span></div>
<div class="line"><a name="l00204"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a36561692c199ed073b8453320fbf867f">  204</a></span>&#160;<span class="preprocessor">#define SPI_CS_HOLD_TIME_US 1   </span><span class="comment">// CS hold time after clock</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">// L6470 Daisy Chain Configuration</span></div>
<div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a636303d8b8a62fe73782ca0cb98f1578">  207</a></span>&#160;<span class="preprocessor">#define L6470_CHAIN_LENGTH 2   </span><span class="comment">// Two motors in daisy chain</span></div>
<div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a64972ab7bdcf5da911a16641794182cf">  208</a></span>&#160;<span class="preprocessor">#define L6470_NOP_COMMAND 0x00 </span><span class="comment">// No-operation command</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">/* Communication Timing and Synchronization (SSOT)                          */</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">// TODO: See .github/instructions/comm-protocols.instructions.md for real-time</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">// requirements</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">// Message Rates (milliseconds between transmissions)</span></div>
<div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a9fbf81d7e51049a54edb3b1c5c7e0245">  217</a></span>&#160;<span class="preprocessor">#define HEARTBEAT_INTERVAL_MS 1000 </span><span class="comment">// CAN heartbeat rate</span></div>
<div class="line"><a name="l00218"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a2a4a4a9463293cd5ba9c37b480414738">  218</a></span>&#160;<span class="preprocessor">#define STATUS_UPDATE_RATE_MS 100  </span><span class="comment">// Motor status updates</span></div>
<div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a9ddd8f07d0b2516e7ea9826e43bb3cfd">  219</a></span>&#160;<span class="preprocessor">#define SENSOR_SAMPLE_RATE_MS 10   </span><span class="comment">// Encoder reading rate</span></div>
<div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a7806944d3d2580d7208d9f051a19f310">  220</a></span>&#160;<span class="preprocessor">#define WATCHDOG_TIMEOUT_MS 5000   </span><span class="comment">// Communication watchdog</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">// Protocol Timeouts</span></div>
<div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a4cb5d01364488d8de93626ed6856ee90">  223</a></span>&#160;<span class="preprocessor">#define CMD_RESPONSE_TIMEOUT_MS 500 </span><span class="comment">// Maximum command processing time</span></div>
<div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#aa393f920680bc7a14ff280deae4303fb">  224</a></span>&#160;<span class="preprocessor">#define LINK_TIMEOUT_MS 10000       </span><span class="comment">// Link failure detection</span></div>
<div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a14445f86300d5faa6a4ebad02e496c09">  225</a></span>&#160;<span class="preprocessor">#define RECONNECT_INTERVAL_MS 30000 </span><span class="comment">// Auto-reconnect attempt rate</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">/* Message Format Definitions (SSOT)                                         */</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">/* ========================================================================== */</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">// TODO: See .github/instructions/comm-protocols.instructions.md for protocol</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">// details</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">// JSON Message Templates (for UART/TCP)</span></div>
<div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a87fd76ce8f4a22be52c27d9321ce7798">  234</a></span>&#160;<span class="preprocessor">#define JSON_MOTOR_STATUS_FMT                                                  \</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="preprocessor">  &quot;{\&quot;motor\&quot;:%d,\&quot;angle\&quot;:%.2f,\&quot;speed\&quot;:%.2f,\&quot;status\&quot;:%d}&quot;</span></div>
<div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#afd6111781367a3876e4ea230240b0af6">  236</a></span>&#160;<span class="preprocessor">#define JSON_COMMAND_FMT &quot;{\&quot;cmd\&quot;:\&quot;%s\&quot;,\&quot;motor\&quot;:%d,\&quot;value\&quot;:%.2f}&quot;</span></div>
<div class="line"><a name="l00237"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a9b3d44087e8aac9d7747c09f1e487a7f">  237</a></span>&#160;<span class="preprocessor">#define JSON_ERROR_FMT &quot;{\&quot;error\&quot;:%d,\&quot;msg\&quot;:\&quot;%s\&quot;,\&quot;timestamp\&quot;:%lu}&quot;</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">// Binary Message Headers (for CAN)</span></div>
<div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#afe6f2e3c2166e681735715c8b608fd4c">  240</a></span>&#160;<span class="preprocessor">#define MSG_HEADER_SYNC 0xAA</span></div>
<div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a7e06331e25d3c8405d67b65da7445ad8">  241</a></span>&#160;<span class="preprocessor">#define MSG_HEADER_VERSION 0x01</span></div>
<div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a40c06c9e4112499999a9c4ceaddde87c">  242</a></span>&#160;<span class="preprocessor">#define MSG_CHECKSUM_POLY 0x1D </span><span class="comment">// CRC polynomial</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">// Message Priority Levels</span></div>
<div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a7947236cdeb72c40f155d2611cbb5337">  245</a></span>&#160;<span class="preprocessor">#define MSG_PRIORITY_EMERGENCY 0 </span><span class="comment">// Emergency stop, faults</span></div>
<div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a27dbad78e85ad0416b6836c074e8b642">  246</a></span>&#160;<span class="preprocessor">#define MSG_PRIORITY_HIGH 1      </span><span class="comment">// Real-time control</span></div>
<div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#af108c42835bc95dad38fe26e7f690db3">  247</a></span>&#160;<span class="preprocessor">#define MSG_PRIORITY_NORMAL 2    </span><span class="comment">// Status updates</span></div>
<div class="line"><a name="l00248"></a><span class="lineno"><a class="line" href="../../d3/d88/comm__config_8h.html#a9b23cafdc66b0fd36743de2529728e1b">  248</a></span>&#160;<span class="preprocessor">#define MSG_PRIORITY_LOW 3       </span><span class="comment">// Configuration, diagnostics</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* COMM_CONFIG_H */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Aug 5 2025 13:09:32 for STM32H753ZI Motor Control System by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
